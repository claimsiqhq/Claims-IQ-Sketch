# CLAUDE CODE TASK: Expand Line Item Library

## Context
This is a property insurance claims estimation platform. We have an existing PostgreSQL database with a line_items table and related tables for materials, labor rates, and pricing. The current seed data covers water mitigation basics. We need to expand to cover comprehensive property damage scenarios.

## Existing Schema Reference
The line_items table has this structure:
- code: VARCHAR(50) - unique identifier like 'DRY-HTT-12'
- category_id: VARCHAR(20) - references line_item_categories
- description: VARCHAR(500)
- unit: VARCHAR(20) - 'SF', 'LF', 'EA', 'HR', 'CY', 'SY'
- material_components: JSONB array of {sku, qty_per_unit}
- labor_components: JSONB array of {task, hours_per_unit, trade}
- equipment_components: JSONB array of {type, cost_per_unit, condition?}
- waste_factor: DECIMAL default 1.00
- minimum_charge: DECIMAL default 0
- scope_triggers: JSONB array of damage conditions that auto-suggest this item
- related_items: TEXT array of codes commonly paired with this item

Trades for labor: 'general', 'skilled', 'specialty', 'electrical', 'plumbing', 'hvac'

## Task
Create a comprehensive SQL seed file that adds line items for the following categories. Follow the existing patterns in the codebase for consistency.

### Categories to Add/Expand

**1. Fire & Smoke Restoration (Category 04)**
- 04.1 - Smoke Damage Assessment
- 04.2 - Soot Removal (dry soot, wet soot, protein residue)
- 04.3 - Odor Control (thermal fogging, ozone, hydroxyl)
- 04.4 - HVAC Cleaning
- 04.5 - Electronics Cleaning
- 04.6 - Document/Photo Recovery

**2. Roofing (Category 12)**
- 12.1 - Shingle Roofing (3-tab, architectural, premium)
- 12.2 - Underlayment (felt, synthetic)
- 12.3 - Flashing (step, valley, chimney, vent)
- 12.4 - Ventilation (ridge vent, box vent, soffit vent)
- 12.5 - Gutters & Downspouts
- 12.6 - Skylights
- 12.7 - Roof Decking repair/replacement

**3. Exterior/Siding (Category 13)**
- 13.1 - Vinyl Siding
- 13.2 - Fiber Cement (HardiePlank)
- 13.3 - Wood Siding
- 13.4 - Stucco
- 13.5 - Brick Veneer repair
- 13.6 - Soffit & Fascia
- 13.7 - Exterior Painting

**4. Windows & Doors (Category 08)**
- 08.1 - Window Replacement (vinyl, wood, aluminum by size)
- 08.2 - Window Repair (glass only, sash, hardware)
- 08.3 - Exterior Doors (entry, sliding glass, French)
- 08.4 - Interior Doors (hollow core, solid core, specialty)
- 08.5 - Door Hardware
- 08.6 - Garage Doors

**5. Electrical (Category 10)**
- 10.1 - Outlets & Switches
- 10.2 - Lighting Fixtures
- 10.3 - Ceiling Fans
- 10.4 - Panel/Breaker work
- 10.5 - Smoke/CO Detectors
- 10.6 - Low Voltage (doorbell, thermostat wire)

**6. Plumbing (Category 09)**
- 09.1 - Fixture Replacement (toilet, sink, faucet)
- 09.2 - Water Heater
- 09.3 - Pipe Repair
- 09.4 - Drain Cleaning
- 09.5 - Shut-off Valves

**7. HVAC (Category 11)**
- 11.1 - Ductwork (flex, rigid, insulated)
- 11.2 - Registers & Grilles
- 11.3 - HVAC Equipment
- 11.4 - Duct Cleaning

**8. Cabinets & Countertops (Category 08 - Kitchen/Bath)**
- 08.7 - Base Cabinets
- 08.8 - Wall Cabinets
- 08.9 - Countertops (laminate, granite, quartz, solid surface)
- 08.10 - Cabinet Hardware

**9. Additional Flooring (expand Category 07)**
- 07.3 - Ceramic/Porcelain Tile
- 07.5 - Laminate
- 07.6 - Hardwood Refinishing
- 07.7 - Subfloor Repair/Replacement
- 07.8 - Floor Transitions

**10. Insulation (Category 05)**
- 05.1 - Batt Insulation (R-13, R-19, R-30, R-38)
- 05.2 - Blown Insulation
- 05.3 - Spray Foam
- 05.4 - Vapor Barrier

### Requirements for Each Line Item

1. **Realistic Pricing Components**
   - Material components should reference SKUs in materials table (add new materials as needed)
   - Labor hours should be realistic for the task
   - Include equipment costs where applicable

2. **Scope Triggers**
   - Define what damage scenarios auto-suggest this item
   - Include damage_type, severity levels, affected surfaces where relevant

3. **Related Items**
   - Link items that are commonly used together
   - Example: Drywall replacement should relate to paint, texture, primer

4. **Waste Factors**
   - 1.10 (10%) for most materials
   - 1.05 (5%) for precision work
   - 1.15 (15%) for complex cuts/patterns

5. **Minimum Charges**
   - Small repair items should have minimums
   - Example: Drywall patch minimum $50, electrical outlet minimum $75

### Output Structure

Create the following files:

1. `db/seeds/02_categories_expanded.sql` - New categories
2. `db/seeds/03_materials_expanded.sql` - New materials for new line items
3. `db/seeds/04_line_items_fire_smoke.sql` - Fire/smoke restoration items
4. `db/seeds/05_line_items_roofing.sql` - Roofing items
5. `db/seeds/06_line_items_exterior.sql` - Exterior/siding items
6. `db/seeds/07_line_items_windows_doors.sql` - Windows and doors
7. `db/seeds/08_line_items_mep.sql` - Mechanical/Electrical/Plumbing
8. `db/seeds/09_line_items_cabinets.sql` - Cabinets and countertops
9. `db/seeds/10_line_items_flooring_expanded.sql` - Additional flooring
10. `db/seeds/11_line_items_insulation.sql` - Insulation items

### Example Line Item Format (follow this pattern)
```sql
INSERT INTO line_items (
    code, category_id, description, unit,
    material_components, labor_components, equipment_components,
    waste_factor, minimum_charge, scope_triggers, related_items
) VALUES (
    'ROOF-SHNG-ARCH',
    '12.1',
    'Roofing - Architectural shingles - remove & replace',
    'SQ',  -- roofing square = 100 SF
    '[
        {"sku": "SHNG-ARCH-BDL", "qty_per_unit": 3.0},
        {"sku": "FELT-15", "qty_per_unit": 1.0},
        {"sku": "NAILS-ROOF", "qty_per_unit": 2.5},
        {"sku": "STARTR-STRIP", "qty_per_unit": 0.33},
        {"sku": "RIDGE-CAP", "qty_per_unit": 0.2}
    ]'::jsonb,
    '[
        {"task": "tear_off", "hours_per_unit": 0.75, "trade": "general"},
        {"task": "install", "hours_per_unit": 1.5, "trade": "skilled"}
    ]'::jsonb,
    '[
        {"type": "ladder_scaffolding", "cost_per_unit": 15.00},
        {"type": "debris_container", "cost_per_unit": 25.00}
    ]'::jsonb,
    1.10,
    350.00,  -- minimum charge for small roof repairs
    '[
        {"damage_type": "wind", "surface": "roof"},
        {"damage_type": "hail", "surface": "roof"},
        {"damage_type": "impact", "surface": "roof"}
    ]'::jsonb,
    ARRAY['ROOF-FELT-SYN', 'ROOF-FLASH-STEP', 'ROOF-VENT-RIDGE', 'DEM-HAUL']
);
```

### Materials to Add

For each new line item category, add corresponding materials with realistic base prices. Example:
```sql
INSERT INTO materials (sku, name, unit, base_price, price_source) VALUES
-- Roofing Materials
('SHNG-3TAB-BDL', '3-Tab shingles bundle', 'EA', 32.00, 'baseline_2024'),
('SHNG-ARCH-BDL', 'Architectural shingles bundle', 'EA', 42.00, 'baseline_2024'),
('FELT-15', 'Roofing felt 15#', 'ROLL', 22.00, 'baseline_2024'),
('FELT-SYN', 'Synthetic underlayment', 'ROLL', 85.00, 'baseline_2024'),
('NAILS-ROOF', 'Roofing nails 1.25"', 'LB', 3.50, 'baseline_2024'),
('STARTR-STRIP', 'Starter strip shingles', 'EA', 18.00, 'baseline_2024'),
('RIDGE-CAP', 'Ridge cap shingles', 'BDL', 55.00, 'baseline_2024'),
('FLASH-ALUM', 'Aluminum flashing roll', 'ROLL', 28.00, 'baseline_2024'),
('VENT-RIDGE', 'Ridge vent', 'LF', 4.50, 'baseline_2024'),
('VENT-BOX', 'Box vent', 'EA', 35.00, 'baseline_2024');
```

### Validation

After creating the seed files:
1. Ensure all category_id references exist
2. Ensure all material SKUs referenced in line items exist
3. Verify no duplicate codes
4. Run a test query to verify JSON is valid

Create a validation script: `db/seeds/99_validate_seeds.sql`
```sql
-- Check for orphaned category references
SELECT code, category_id FROM line_items 
WHERE category_id NOT IN (SELECT id FROM line_item_categories);

-- Check for missing material SKUs
-- (Would need a more complex query to parse JSONB)

-- Check for duplicate codes
SELECT code, COUNT(*) FROM line_items GROUP BY code HAVING COUNT(*) > 1;
```

## Success Criteria
- At least 150 new line items across all categories
- All necessary materials added
- All category hierarchies properly defined
- Realistic pricing that would be acceptable to insurance carriers
- Proper scope_triggers for AI-assisted scoping
- Related items linked for completeness checking