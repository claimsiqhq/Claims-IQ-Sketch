# Claims IQ Sketch — Complete Estimate System Build

## Overview

This prompt builds a **carrier-ready estimate generation system** for Claims IQ Sketch. It covers:

1. **Schema Audit** — Understand existing structure
2. **Product Catalog Expansion** — 150+ line items across all categories
3. **Depreciation Engine** — Age/life calculations with condition adjustments
4. **Coverage Assignment** — Dwelling (A), Personal Property (B), Loss of Use (C)
5. **Damage Area Hierarchy** — Spatial organization linked to Sketch zones
6. **Price List Management** — Regional versioning with external API hooks
7. **Tax Engine** — Multi-rate tax calculations
8. **Settlement Calculator** — RCV, ACV, deductibles, recoverable depreciation
9. **API Routes** — Full CRUD for estimates
10. **Report Output** — Xactimate-compatible format

---

## Part 1: Schema Audit

First, understand the existing database structure.

```bash
# Find the schema definition
find . -type f \( -name "schema.ts" -o -name "schema.prisma" -o -name "*.sql" \) | head -20

# Look for existing estimate-related tables
grep -r "estimate" --include="*.ts" --include="*.sql" -l

# Find seed files
find . -type f -name "*seed*" | head -10

# Check for existing line items or materials
grep -r "line_item\|lineItem\|material" --include="*.ts" -l | head -10
```

Review the output and identify:
- Database ORM (Drizzle, Prisma, raw SQL)
- Existing tables related to estimates, claims, line items
- Current seed data structure

---

## Part 2: Core Schema — New Tables

Create these tables. Adapt syntax for your ORM (examples in Drizzle + raw SQL).

### 2.1 Price Lists

```sql
-- Price list versioning (like Xactimate's MOSL8X_MAR25)
CREATE TABLE price_lists (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(20) NOT NULL UNIQUE,        -- 'TXDFW_DEC25'
  name VARCHAR(100) NOT NULL,              -- 'Texas - Dallas/Fort Worth - December 2025'
  region_code VARCHAR(10) NOT NULL,        -- 'TX-DFW'
  effective_date DATE NOT NULL,
  expiration_date DATE,
  source VARCHAR(50) DEFAULT 'internal',   -- 'internal', 'xactimate', '1build', 'itel'
  base_multiplier DECIMAL(5,4) DEFAULT 1.0000,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Seed default price list
INSERT INTO price_lists (code, name, region_code, effective_date, source) VALUES
('NATL_DEC25', 'National Baseline - December 2025', 'NATIONAL', '2025-12-01', 'internal');
```

### 2.2 Coverage Types

```sql
-- Insurance coverage categories
CREATE TABLE coverage_types (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(10) NOT NULL UNIQUE,        -- 'A', 'B', 'C'
  name VARCHAR(100) NOT NULL,              -- 'Coverage A - Dwelling'
  description TEXT,
  default_deductible DECIMAL(10,2) DEFAULT 0,
  sort_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true
);

INSERT INTO coverage_types (code, name, description, sort_order) VALUES
('A', 'Coverage A - Dwelling', 'Structural damage to the insured dwelling', 1),
('B', 'Coverage B - Other Structures', 'Detached structures like fences, sheds, detached garages', 2),
('C', 'Coverage C - Personal Property', 'Contents and personal belongings', 3),
('D', 'Coverage D - Loss of Use', 'Additional living expenses during repairs', 4);
```

### 2.3 Tax Rates

```sql
-- Multi-rate tax configuration
CREATE TABLE tax_rates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  region_code VARCHAR(20) NOT NULL,        -- 'TX-DFW', 'MO-STL', 'NATIONAL'
  tax_type VARCHAR(50) NOT NULL,           -- 'material_sales', 'labor', 'equipment'
  tax_name VARCHAR(100) NOT NULL,          -- 'Material Sales Tax'
  rate DECIMAL(6,4) NOT NULL,              -- 0.0635 = 6.35%
  applies_to VARCHAR(50) DEFAULT 'materials', -- 'materials', 'labor', 'all'
  is_active BOOLEAN DEFAULT true,
  effective_date DATE DEFAULT CURRENT_DATE,
  UNIQUE(region_code, tax_type)
);

INSERT INTO tax_rates (region_code, tax_type, tax_name, rate, applies_to) VALUES
('NATIONAL', 'material_sales', 'Material Sales Tax', 0.0625, 'materials'),
('TX-DFW', 'material_sales', 'TX Sales Tax', 0.0825, 'materials'),
('TX-HOU', 'material_sales', 'TX Sales Tax', 0.0825, 'materials'),
('MO-STL', 'material_sales', 'MO Sales Tax', 0.0635, 'materials'),
('CA-LA', 'material_sales', 'CA Sales Tax', 0.0950, 'materials'),
('FL-MIA', 'material_sales', 'FL Sales Tax', 0.0700, 'materials');
```

### 2.4 Depreciation Schedules

```sql
-- Depreciation rules by item type
CREATE TABLE depreciation_schedules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  category_code VARCHAR(10) NOT NULL,
  item_type VARCHAR(100) NOT NULL,         -- 'laminated_shingle', 'vinyl_siding', 'hvac_unit'
  useful_life_years INTEGER NOT NULL,      -- 30 for shingles, 50 for siding
  max_depreciation_pct DECIMAL(5,2) DEFAULT 80.00,
  depreciation_method VARCHAR(30) DEFAULT 'straight_line',
  condition_adjustment_good DECIMAL(5,2) DEFAULT 0.85,   -- Multiply by this if condition is good
  condition_adjustment_poor DECIMAL(5,2) DEFAULT 1.15,   -- Multiply by this if condition is poor
  is_depreciable BOOLEAN DEFAULT true,
  notes TEXT,
  UNIQUE(category_code, item_type)
);

INSERT INTO depreciation_schedules (category_code, item_type, useful_life_years, max_depreciation_pct, notes) VALUES
-- Roofing (Category 12)
('12', 'asphalt_3tab_shingle', 20, 80.00, 'Standard 3-tab shingles'),
('12', 'asphalt_laminated_shingle', 30, 80.00, 'Architectural/dimensional shingles'),
('12', 'asphalt_premium_shingle', 40, 80.00, 'Premium/designer shingles'),
('12', 'metal_roofing', 50, 80.00, 'Standing seam or metal panels'),
('12', 'tile_roofing', 50, 80.00, 'Clay or concrete tile'),
('12', 'flat_roof_membrane', 20, 80.00, 'TPO, EPDM, modified bitumen'),
('12', 'roof_underlayment', 30, 80.00, 'Matches shingle life'),
('12', 'roof_flashing', 30, 80.00, 'Step, valley, drip edge'),
('12', 'gutters_aluminum', 25, 80.00, 'Aluminum gutters and downspouts'),
('12', 'gutters_copper', 50, 80.00, 'Copper gutters'),

-- Siding (Category 07)
('07', 'vinyl_siding', 40, 80.00, 'Vinyl siding panels'),
('07', 'fiber_cement_siding', 50, 80.00, 'HardiePlank or similar'),
('07', 'wood_siding', 30, 80.00, 'Natural wood siding'),
('07', 'aluminum_siding', 40, 80.00, 'Aluminum siding'),
('07', 'stucco', 50, 80.00, 'Traditional or EIFS stucco'),
('07', 'brick_veneer', 75, 80.00, 'Brick facade'),

-- Windows & Doors (Category 08)
('08', 'vinyl_window', 25, 80.00, 'Standard vinyl windows'),
('08', 'wood_window', 30, 80.00, 'Wood frame windows'),
('08', 'aluminum_window', 25, 80.00, 'Aluminum frame windows'),
('08', 'entry_door_wood', 30, 80.00, 'Solid wood entry door'),
('08', 'entry_door_fiberglass', 30, 80.00, 'Fiberglass entry door'),
('08', 'entry_door_steel', 25, 80.00, 'Steel entry door'),
('08', 'garage_door', 20, 80.00, 'Garage door'),
('08', 'sliding_glass_door', 25, 80.00, 'Patio sliding door'),

-- Drywall & Interior (Category 06)
('06', 'drywall', 50, 80.00, 'Interior drywall'),
('06', 'plaster', 75, 80.00, 'Traditional plaster walls'),

-- Flooring (Category 09)
('09', 'carpet', 10, 80.00, 'Wall-to-wall carpet'),
('09', 'carpet_pad', 10, 80.00, 'Carpet padding'),
('09', 'hardwood_flooring', 50, 80.00, 'Solid hardwood'),
('09', 'engineered_hardwood', 30, 80.00, 'Engineered wood flooring'),
('09', 'laminate_flooring', 20, 80.00, 'Laminate plank flooring'),
('09', 'lvp_flooring', 25, 80.00, 'Luxury vinyl plank'),
('09', 'ceramic_tile', 50, 80.00, 'Ceramic or porcelain tile'),
('09', 'vinyl_sheet', 15, 80.00, 'Sheet vinyl'),

-- Painting (Category 14)
('14', 'interior_paint', 7, 80.00, 'Interior wall paint'),
('14', 'exterior_paint', 10, 80.00, 'Exterior paint'),

-- HVAC (Category 15)
('15', 'hvac_furnace', 20, 80.00, 'Gas or electric furnace'),
('15', 'hvac_ac_condenser', 15, 80.00, 'AC condenser unit'),
('15', 'hvac_heat_pump', 15, 80.00, 'Heat pump system'),
('15', 'water_heater_tank', 12, 80.00, 'Tank water heater'),
('15', 'water_heater_tankless', 20, 80.00, 'Tankless water heater'),

-- Electrical (Category 16)
('16', 'electrical_panel', 40, 80.00, 'Main electrical panel'),
('16', 'electrical_wiring', 50, 80.00, 'House wiring'),

-- Plumbing (Category 22)
('22', 'plumbing_fixtures', 25, 80.00, 'Sinks, faucets, toilets'),
('22', 'plumbing_pipes_copper', 50, 80.00, 'Copper supply lines'),
('22', 'plumbing_pipes_pex', 50, 80.00, 'PEX supply lines'),

-- Appliances (Category 11)
('11', 'appliance_refrigerator', 15, 80.00, 'Refrigerator'),
('11', 'appliance_range', 15, 80.00, 'Stove/range'),
('11', 'appliance_dishwasher', 12, 80.00, 'Dishwasher'),
('11', 'appliance_washer', 12, 80.00, 'Washing machine'),
('11', 'appliance_dryer', 15, 80.00, 'Dryer'),

-- Fencing (Category 32)
('32', 'fence_wood', 15, 80.00, 'Wood privacy fence'),
('32', 'fence_chain_link', 20, 80.00, 'Chain link fence'),
('32', 'fence_vinyl', 25, 80.00, 'Vinyl fence'),
('32', 'fence_wrought_iron', 40, 80.00, 'Wrought iron fence'),

-- Water Mitigation (Category 01) - Generally not depreciated
('01', 'water_mitigation', 0, 0.00, 'Emergency services - no depreciation'),

-- Demolition (Category 02) - Generally not depreciated  
('02', 'demolition', 0, 0.00, 'Demo work - no depreciation');
```

### 2.5 Regional Multipliers

```sql
-- Regional cost adjustments
CREATE TABLE regional_multipliers (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  region_code VARCHAR(20) NOT NULL UNIQUE,
  region_name VARCHAR(100) NOT NULL,
  material_multiplier DECIMAL(5,4) DEFAULT 1.0000,
  labor_multiplier DECIMAL(5,4) DEFAULT 1.0000,
  equipment_multiplier DECIMAL(5,4) DEFAULT 1.0000,
  is_active BOOLEAN DEFAULT true,
  updated_at TIMESTAMP DEFAULT NOW()
);

INSERT INTO regional_multipliers (region_code, region_name, material_multiplier, labor_multiplier, equipment_multiplier) VALUES
('NATIONAL', 'National Average', 1.0000, 1.0000, 1.0000),
('TX-DFW', 'Texas - Dallas/Fort Worth', 0.98, 0.95, 0.97),
('TX-HOU', 'Texas - Houston', 1.00, 0.97, 0.98),
('TX-AUS', 'Texas - Austin', 1.02, 1.00, 1.00),
('TX-SAT', 'Texas - San Antonio', 0.96, 0.93, 0.95),
('CA-LA', 'California - Los Angeles', 1.15, 1.35, 1.20),
('CA-SF', 'California - San Francisco', 1.20, 1.50, 1.25),
('CA-SD', 'California - San Diego', 1.12, 1.30, 1.18),
('NY-NYC', 'New York - New York City', 1.25, 1.45, 1.30),
('FL-MIA', 'Florida - Miami', 1.08, 1.10, 1.05),
('FL-ORL', 'Florida - Orlando', 1.02, 1.00, 1.00),
('FL-TPA', 'Florida - Tampa', 1.00, 0.98, 0.98),
('CO-DEN', 'Colorado - Denver', 1.05, 1.10, 1.05),
('IL-CHI', 'Illinois - Chicago', 1.10, 1.25, 1.15),
('WA-SEA', 'Washington - Seattle', 1.12, 1.30, 1.15),
('AZ-PHX', 'Arizona - Phoenix', 1.00, 0.95, 0.98),
('GA-ATL', 'Georgia - Atlanta', 1.02, 1.00, 1.00),
('NC-CLT', 'North Carolina - Charlotte', 0.98, 0.95, 0.97),
('MO-STL', 'Missouri - St. Louis', 0.95, 0.98, 0.96),
('MO-KC', 'Missouri - Kansas City', 0.94, 0.96, 0.95);
```

### 2.6 Labor Rates

```sql
-- Labor rates by trade
CREATE TABLE labor_rates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  trade_code VARCHAR(20) NOT NULL,
  trade_name VARCHAR(100) NOT NULL,
  base_hourly_rate DECIMAL(10,2) NOT NULL,
  overtime_multiplier DECIMAL(4,2) DEFAULT 1.50,
  region_code VARCHAR(20) DEFAULT 'NATIONAL',
  effective_date DATE DEFAULT CURRENT_DATE,
  is_active BOOLEAN DEFAULT true,
  UNIQUE(trade_code, region_code)
);

INSERT INTO labor_rates (trade_code, trade_name, base_hourly_rate, region_code) VALUES
-- National baseline rates
('GEN', 'General Labor', 35.00, 'NATIONAL'),
('CARP', 'Carpenter', 55.00, 'NATIONAL'),
('ROOF', 'Roofer', 60.00, 'NATIONAL'),
('ELEC', 'Electrician', 85.00, 'NATIONAL'),
('PLMB', 'Plumber', 85.00, 'NATIONAL'),
('HVAC', 'HVAC Technician', 80.00, 'NATIONAL'),
('PAINT', 'Painter', 45.00, 'NATIONAL'),
('DRYWALL', 'Drywall Installer/Finisher', 50.00, 'NATIONAL'),
('FLOOR', 'Flooring Installer', 55.00, 'NATIONAL'),
('MASON', 'Mason', 65.00, 'NATIONAL'),
('SIDING', 'Siding Installer', 55.00, 'NATIONAL'),
('GLASS', 'Glazier', 60.00, 'NATIONAL'),
('INSUL', 'Insulation Installer', 45.00, 'NATIONAL'),
('DEMO', 'Demolition', 40.00, 'NATIONAL'),
('MITI', 'Water Mitigation Tech', 55.00, 'NATIONAL'),
('FENCE', 'Fence Installer', 50.00, 'NATIONAL');
```

### 2.7 Carrier Profiles

```sql
-- Carrier-specific rules
CREATE TABLE carrier_profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  carrier_code VARCHAR(20) NOT NULL UNIQUE,
  carrier_name VARCHAR(100) NOT NULL,
  overhead_pct DECIMAL(5,2) DEFAULT 10.00,
  profit_pct DECIMAL(5,2) DEFAULT 10.00,
  op_threshold DECIMAL(10,2) DEFAULT 0.00,    -- Min RCV to qualify for O&P
  op_trade_minimum INTEGER DEFAULT 3,          -- Min trades to qualify for O&P
  tax_on_materials_only BOOLEAN DEFAULT true,
  requires_three_bids BOOLEAN DEFAULT false,
  requires_photos BOOLEAN DEFAULT true,
  requires_measurements BOOLEAN DEFAULT true,
  depreciation_method VARCHAR(30) DEFAULT 'straight_line',
  max_depreciation_pct DECIMAL(5,2) DEFAULT 80.00,
  notes TEXT,
  is_active BOOLEAN DEFAULT true
);

INSERT INTO carrier_profiles (carrier_code, carrier_name, overhead_pct, profit_pct, op_threshold, op_trade_minimum, notes) VALUES
('DEFAULT', 'Default Profile', 10.00, 10.00, 0.00, 3, 'Standard O&P rules'),
('STFM', 'State Farm', 10.00, 10.00, 1000.00, 3, 'O&P only for jobs > $1000 with 3+ trades'),
('ALST', 'Allstate', 10.00, 10.00, 2500.00, 3, 'Higher O&P threshold'),
('USAA', 'USAA', 10.00, 10.00, 0.00, 3, 'Standard O&P'),
('FARM', 'Farmers', 10.00, 10.00, 1500.00, 3, 'Mid-range threshold'),
('LBTY', 'Liberty Mutual', 10.00, 10.00, 2000.00, 3, 'Standard with threshold'),
('PROG', 'Progressive', 10.00, 10.00, 1000.00, 3, 'Standard rules'),
('TRAV', 'Travelers', 10.00, 10.00, 1500.00, 3, 'Standard rules'),
('NATIONWIDE', 'Nationwide', 10.00, 10.00, 1000.00, 3, 'Standard rules'),
('AMICA', 'Amica', 10.00, 10.00, 0.00, 2, 'Lower trade requirement');
```

---

## Part 3: Line Item Categories

```sql
-- Categories with proper hierarchy
CREATE TABLE line_item_categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(10) NOT NULL UNIQUE,
  name VARCHAR(100) NOT NULL,
  parent_code VARCHAR(10),
  description TEXT,
  default_coverage_code VARCHAR(10) DEFAULT 'A',
  sort_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true
);

INSERT INTO line_item_categories (code, name, parent_code, default_coverage_code, sort_order) VALUES
-- Main Categories
('01', 'Water Mitigation', NULL, 'A', 1),
('02', 'Demolition & Debris', NULL, 'A', 2),
('03', 'Temporary Repairs', NULL, 'A', 3),
('04', 'Concrete & Masonry', NULL, 'A', 4),
('05', 'Framing & Rough Carpentry', NULL, 'A', 5),
('06', 'Drywall & Plaster', NULL, 'A', 6),
('07', 'Siding & Exterior', NULL, 'A', 7),
('08', 'Windows & Doors', NULL, 'A', 8),
('09', 'Flooring', NULL, 'A', 9),
('10', 'Insulation', NULL, 'A', 10),
('11', 'Appliances', NULL, 'C', 11),
('12', 'Roofing', NULL, 'A', 12),
('13', 'Fire & Smoke', NULL, 'A', 13),
('14', 'Interior Painting', NULL, 'A', 14),
('15', 'Cabinets & Countertops', NULL, 'A', 15),
('16', 'Electrical', NULL, 'A', 16),
('22', 'Plumbing', NULL, 'A', 22),
('23', 'HVAC', NULL, 'A', 23),
('32', 'Fencing & Site Work', NULL, 'B', 32),
('99', 'General Conditions', NULL, 'A', 99),

-- Water Mitigation Subcategories
('01-01', 'Emergency Response', '01', 'A', 101),
('01-02', 'Water Extraction', '01', 'A', 102),
('01-03', 'Structural Drying', '01', 'A', 103),
('01-04', 'Moisture Monitoring', '01', 'A', 104),
('01-05', 'Content Manipulation', '01', 'C', 105),
('01-06', 'Antimicrobial Treatment', '01', 'A', 106),

-- Demolition Subcategories
('02-01', 'Selective Demolition', '02', 'A', 201),
('02-02', 'Debris Removal', '02', 'A', 202),
('02-03', 'Containment & Protection', '02', 'A', 203),

-- Drywall Subcategories
('06-01', 'Drywall Removal', '06', 'A', 601),
('06-02', 'Drywall Installation', '06', 'A', 602),
('06-03', 'Drywall Finishing', '06', 'A', 603),
('06-04', 'Drywall Repairs', '06', 'A', 604),

-- Roofing Subcategories
('12-01', 'Roof Tear-Off', '12', 'A', 1201),
('12-02', 'Roof Decking', '12', 'A', 1202),
('12-03', 'Underlayment', '12', 'A', 1203),
('12-04', 'Shingles', '12', 'A', 1204),
('12-05', 'Flashing', '12', 'A', 1205),
('12-06', 'Ventilation', '12', 'A', 1206),
('12-07', 'Gutters & Downspouts', '12', 'A', 1207),

-- Interior Painting Subcategories
('14-01', 'Wall Painting', '14', 'A', 1401),
('14-02', 'Ceiling Painting', '14', 'A', 1402),
('14-03', 'Trim Painting', '14', 'A', 1403),
('14-04', 'Priming', '14', 'A', 1404);
```

---

## Part 4: Materials Catalog

```sql
CREATE TABLE materials (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  sku VARCHAR(50) NOT NULL UNIQUE,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  category_code VARCHAR(10) REFERENCES line_item_categories(code),
  unit_of_measure VARCHAR(20) NOT NULL,      -- 'EA', 'SF', 'LF', 'SQ', 'GAL', 'BD'
  base_price DECIMAL(10,2) NOT NULL,
  price_source VARCHAR(50) DEFAULT 'baseline_2025',
  external_id VARCHAR(100),                   -- For 1build/itel mapping
  last_price_sync TIMESTAMP,
  manufacturer VARCHAR(100),
  model_number VARCHAR(100),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Roofing Materials
INSERT INTO materials (sku, name, category_code, unit_of_measure, base_price, manufacturer) VALUES
-- Shingles
('MAT-SHNG-3TAB', '3-Tab Asphalt Shingles (25-year)', '12-04', 'SQ', 95.00, 'GAF/Owens Corning'),
('MAT-SHNG-ARCH', 'Architectural Asphalt Shingles (30-year)', '12-04', 'SQ', 135.00, 'GAF/Owens Corning'),
('MAT-SHNG-PREM', 'Premium Designer Shingles (50-year)', '12-04', 'SQ', 275.00, 'GAF/CertainTeed'),
('MAT-SHNG-RIDGE', 'Hip & Ridge Cap Shingles', '12-04', 'LF', 2.85, 'GAF/Owens Corning'),
('MAT-SHNG-STARTER', 'Starter Strip Shingles', '12-04', 'LF', 1.25, 'GAF/Owens Corning'),

-- Underlayment
('MAT-UNDR-FELT15', '#15 Felt Underlayment', '12-03', 'SQ', 18.00, 'Various'),
('MAT-UNDR-FELT30', '#30 Felt Underlayment', '12-03', 'SQ', 28.00, 'Various'),
('MAT-UNDR-SYNTH', 'Synthetic Underlayment', '12-03', 'SQ', 55.00, 'GAF/CertainTeed'),
('MAT-UNDR-ICE', 'Ice & Water Shield', '12-03', 'SQ', 95.00, 'Grace/GAF'),

-- Flashing
('MAT-FLASH-STEP', 'Step Flashing - Aluminum', '12-05', 'EA', 1.50, 'Various'),
('MAT-FLASH-VALLEY', 'Valley Flashing - Aluminum (20")', '12-05', 'LF', 3.25, 'Various'),
('MAT-FLASH-DRIP', 'Drip Edge - Aluminum', '12-05', 'LF', 1.75, 'Various'),
('MAT-FLASH-PIPE', 'Pipe Boot/Flashing', '12-05', 'EA', 15.00, 'Oatey/Various'),
('MAT-FLASH-VENT', 'Roof Vent Flashing', '12-05', 'EA', 25.00, 'Various'),

-- Ventilation
('MAT-VENT-RIDGE', 'Ridge Vent (shingle-over)', '12-06', 'LF', 4.50, 'Air Vent/Lomanco'),
('MAT-VENT-BOX', 'Box Vent/Roof Louver', '12-06', 'EA', 35.00, 'Air Vent/Lomanco'),
('MAT-VENT-TURB', 'Turbine Vent', '12-06', 'EA', 55.00, 'Lomanco'),
('MAT-VENT-POWER', 'Power Attic Ventilator', '12-06', 'EA', 175.00, 'Various'),
('MAT-VENT-SOFFIT', 'Soffit Vent', '12-06', 'EA', 8.00, 'Various'),

-- Decking
('MAT-DECK-OSB', 'OSB Roof Sheathing (7/16")', '12-02', 'SF', 1.25, 'LP/Weyerhaeuser'),
('MAT-DECK-PLY', 'Plywood Roof Sheathing (1/2" CDX)', '12-02', 'SF', 1.85, 'Various'),
('MAT-DECK-H-CLIP', 'H-Clips for Roof Sheathing', '12-02', 'EA', 0.35, 'Various'),

-- Gutters
('MAT-GUTR-5ALU', '5" Aluminum K-Style Gutter', '12-07', 'LF', 4.50, 'Various'),
('MAT-GUTR-6ALU', '6" Aluminum K-Style Gutter', '12-07', 'LF', 6.00, 'Various'),
('MAT-GUTR-DSPT2X3', '2x3 Aluminum Downspout', '12-07', 'LF', 3.50, 'Various'),
('MAT-GUTR-DSPT3X4', '3x4 Aluminum Downspout', '12-07', 'LF', 5.00, 'Various'),
('MAT-GUTR-ELBOW', 'Gutter Elbow (A or B)', '12-07', 'EA', 6.00, 'Various'),
('MAT-GUTR-HANGER', 'Hidden Gutter Hanger', '12-07', 'EA', 2.50, 'Various'),
('MAT-GUTR-GUARD', 'Gutter Guard/Screen', '12-07', 'LF', 3.00, 'Various'),

-- Drywall Materials
('MAT-DRY-REG12', '1/2" Regular Drywall', '06-02', 'SF', 0.45, 'USG/National Gypsum'),
('MAT-DRY-REG58', '5/8" Regular Drywall', '06-02', 'SF', 0.55, 'USG/National Gypsum'),
('MAT-DRY-MR12', '1/2" Moisture Resistant Drywall', '06-02', 'SF', 0.65, 'USG/National Gypsum'),
('MAT-DRY-MR58', '5/8" Moisture Resistant Drywall', '06-02', 'SF', 0.75, 'USG/National Gypsum'),
('MAT-DRY-FIRE58', '5/8" Type X Fire-Rated Drywall', '06-02', 'SF', 0.60, 'USG/National Gypsum'),
('MAT-DRY-TAPE', 'Drywall Joint Tape (paper)', '06-03', 'LF', 0.03, 'USG'),
('MAT-DRY-MUD', 'Drywall Joint Compound (all-purpose)', '06-03', 'GAL', 12.00, 'USG/DAP'),
('MAT-DRY-SCREW', 'Drywall Screws (1-5/8")', '06-02', 'LB', 8.00, 'Various'),
('MAT-DRY-CORNER', 'Metal Corner Bead', '06-03', 'LF', 0.75, 'Various'),

-- Interior Paint
('MAT-PAINT-FLAT', 'Interior Latex Paint - Flat', '14-01', 'GAL', 35.00, 'Sherwin-Williams/Behr'),
('MAT-PAINT-EGG', 'Interior Latex Paint - Eggshell', '14-01', 'GAL', 42.00, 'Sherwin-Williams/Behr'),
('MAT-PAINT-SEMI', 'Interior Latex Paint - Semi-Gloss', '14-01', 'GAL', 45.00, 'Sherwin-Williams/Behr'),
('MAT-PAINT-CEIL', 'Ceiling Paint - Flat White', '14-02', 'GAL', 32.00, 'Sherwin-Williams/Behr'),
('MAT-PRIME-STD', 'Primer - Standard PVA', '14-04', 'GAL', 28.00, 'Sherwin-Williams/Behr'),
('MAT-PRIME-STAIN', 'Primer - Stain Blocking', '14-04', 'GAL', 48.00, 'Kilz/Zinsser'),
('MAT-PRIME-MOLD', 'Primer - Mold Resistant', '14-04', 'GAL', 55.00, 'Kilz/Zinsser'),

-- Water Mitigation Equipment/Materials
('MAT-MITI-DEHULG', 'LGR Dehumidifier (rental/day)', '01-03', 'DAY', 85.00, 'Phoenix/Dri-Eaz'),
('MAT-MITI-DEHUCON', 'Conventional Dehumidifier (rental/day)', '01-03', 'DAY', 55.00, 'Phoenix/Dri-Eaz'),
('MAT-MITI-AIRMOV', 'Air Mover/Fan (rental/day)', '01-03', 'DAY', 35.00, 'Phoenix/Dri-Eaz'),
('MAT-MITI-HEPA', 'HEPA Air Scrubber (rental/day)', '01-03', 'DAY', 125.00, 'Phoenix/Dri-Eaz'),
('MAT-MITI-EXTRACT', 'Water Extractor (rental/day)', '01-02', 'DAY', 75.00, 'Various'),
('MAT-MITI-ANTIMICRO', 'Antimicrobial Solution', '01-06', 'GAL', 35.00, 'Microban/Benefect'),
('MAT-MITI-PLASTIC', 'Poly Sheeting (6 mil)', '01-03', 'SF', 0.15, 'Various'),
('MAT-MITI-INJECT', 'Injection Drying System (rental/day)', '01-03', 'DAY', 95.00, 'Dri-Eaz'),

-- Flooring Materials
('MAT-FLR-CARP', 'Carpet (mid-grade)', '09', 'SY', 28.00, 'Shaw/Mohawk'),
('MAT-FLR-PAD', 'Carpet Pad (8lb rebond)', '09', 'SY', 6.00, 'Various'),
('MAT-FLR-LVP', 'Luxury Vinyl Plank (mid-grade)', '09', 'SF', 3.50, 'Shaw/COREtec'),
('MAT-FLR-LAM', 'Laminate Flooring (mid-grade)', '09', 'SF', 2.75, 'Pergo/Mohawk'),
('MAT-FLR-TILE', 'Ceramic Tile (standard)', '09', 'SF', 4.00, 'Various'),
('MAT-FLR-HARDWD', 'Hardwood Flooring (oak)', '09', 'SF', 8.00, 'Bruce/Various'),

-- Insulation
('MAT-INSUL-BATT', 'Fiberglass Batt Insulation (R-19)', '10', 'SF', 0.85, 'Owens Corning/Johns Manville'),
('MAT-INSUL-BLOWN', 'Blown-In Insulation (cellulose)', '10', 'SF', 1.25, 'Various'),
('MAT-INSUL-SPRAY', 'Spray Foam Insulation (closed cell)', '10', 'SF', 2.50, 'Various'),

-- Siding Materials
('MAT-SID-VINYL', 'Vinyl Siding (double 4")', '07', 'SF', 2.25, 'CertainTeed/Alside'),
('MAT-SID-HARDI', 'Fiber Cement Siding (HardiePlank)', '07', 'SF', 3.50, 'James Hardie'),
('MAT-SID-WOOD', 'Wood Siding (cedar)', '07', 'SF', 6.00, 'Various'),
('MAT-SID-ALUM', 'Aluminum Siding', '07', 'SF', 3.00, 'Various'),

-- Windows
('MAT-WIN-VINYL-DH', 'Vinyl Double-Hung Window (standard)', '08', 'EA', 275.00, 'Pella/Andersen/Milgard'),
('MAT-WIN-VINYL-SLD', 'Vinyl Sliding Window', '08', 'EA', 250.00, 'Pella/Andersen/Milgard'),
('MAT-WIN-VINYL-PIC', 'Vinyl Picture Window', '08', 'EA', 325.00, 'Pella/Andersen/Milgard'),

-- Doors
('MAT-DOOR-INT', 'Interior Door (hollow core)', '08', 'EA', 85.00, 'Masonite/JELD-WEN'),
('MAT-DOOR-INTSOLID', 'Interior Door (solid core)', '08', 'EA', 175.00, 'Masonite/JELD-WEN'),
('MAT-DOOR-ENTRY', 'Entry Door (fiberglass)', '08', 'EA', 450.00, 'Therma-Tru/JELD-WEN'),
('MAT-DOOR-GARAGE', 'Garage Door (16x7 steel)', '08', 'EA', 950.00, 'Clopay/Amarr'),

-- Fencing
('MAT-FENCE-WOOD', 'Wood Privacy Fence (6ft cedar)', '32', 'LF', 22.00, 'Various'),
('MAT-FENCE-CLINK', 'Chain Link Fence (4ft galv)', '32', 'LF', 12.00, 'Various'),
('MAT-FENCE-VINYL', 'Vinyl Privacy Fence (6ft)', '32', 'LF', 28.00, 'Various'),
('MAT-FENCE-POST', 'Fence Post (4x4x8 treated)', '32', 'EA', 15.00, 'Various');
```

---

## Part 5: Line Items (Services/Labor)

```sql
CREATE TABLE line_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(30) NOT NULL UNIQUE,
  category_code VARCHAR(10) REFERENCES line_item_categories(code),
  name VARCHAR(200) NOT NULL,
  description TEXT,
  unit_of_measure VARCHAR(20) NOT NULL,
  
  -- Pricing components
  base_material_cost DECIMAL(10,2) DEFAULT 0,
  base_labor_cost DECIMAL(10,2) DEFAULT 0,
  base_equipment_cost DECIMAL(10,2) DEFAULT 0,
  unit_price DECIMAL(10,2) NOT NULL,         -- Total per unit
  
  -- Labor details
  labor_hours_per_unit DECIMAL(6,3),
  trade_code VARCHAR(20),
  
  -- Material components (JSON array)
  material_components JSONB,                  -- [{"sku": "MAT-SHNG-ARCH", "qty_per_unit": 1.15}]
  
  -- Calculation rules
  waste_factor DECIMAL(4,2) DEFAULT 0.00,    -- 0.10 = 10% waste
  minimum_charge DECIMAL(10,2) DEFAULT 0,
  
  -- Depreciation
  depreciation_type VARCHAR(50),              -- Maps to depreciation_schedules.item_type
  
  -- Coverage
  default_coverage_code VARCHAR(10) DEFAULT 'A',
  
  -- Scope triggers (when to include this item)
  scope_triggers JSONB,                       -- ["water_damage", "fire_damage", "wind_damage"]
  
  -- Related items
  related_items JSONB,                        -- ["RFG-FELT", "RFG-DRIP"]
  
  -- External mapping
  xactimate_code VARCHAR(30),                 -- Xactimate selector code if known
  
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);

-- ============================================
-- ROOFING LINE ITEMS
-- ============================================

INSERT INTO line_items (code, category_code, name, description, unit_of_measure, base_material_cost, base_labor_cost, unit_price, labor_hours_per_unit, trade_code, material_components, waste_factor, minimum_charge, depreciation_type, xactimate_code) VALUES

-- Tear-Off
('RFG-TEAR-SHNG1', '12-01', 'Remove Roofing - 1 layer shingles', 'Remove existing asphalt shingle roofing, single layer, including disposal', 'SQ', 0.00, 45.00, 45.00, 0.75, 'ROOF', NULL, 0.00, 150.00, NULL, 'RFG RSFG<'),
('RFG-TEAR-SHNG2', '12-01', 'Remove Roofing - 2 layers shingles', 'Remove existing asphalt shingle roofing, two layers, including disposal', 'SQ', 0.00, 75.00, 75.00, 1.25, 'ROOF', NULL, 0.00, 200.00, NULL, 'RFG RSFG<2'),
('RFG-TEAR-FELT', '12-01', 'Remove Underlayment/Felt', 'Remove existing roof underlayment only', 'SQ', 0.00, 15.00, 15.00, 0.25, 'ROOF', NULL, 0.00, 50.00, NULL, NULL),

-- Decking
('RFG-DECK-OSB', '12-02', 'Install OSB Roof Sheathing', 'Install 7/16" OSB roof sheathing', 'SF', 1.25, 1.50, 2.75, 0.025, 'CARP', '[{"sku": "MAT-DECK-OSB", "qty_per_unit": 1.10}]', 0.10, 100.00, 'asphalt_laminated_shingle', 'RFG OSB'),
('RFG-DECK-PLY', '12-02', 'Install Plywood Roof Sheathing', 'Install 1/2" CDX plywood roof sheathing', 'SF', 1.85, 1.50, 3.35, 0.025, 'CARP', '[{"sku": "MAT-DECK-PLY", "qty_per_unit": 1.10}]', 0.10, 100.00, 'asphalt_laminated_shingle', 'RFG PLYW'),

-- Underlayment
('RFG-FELT-15', '12-03', 'Install #15 Felt Underlayment', 'Install #15 asphalt felt underlayment', 'SQ', 18.00, 12.00, 30.00, 0.20, 'ROOF', '[{"sku": "MAT-UNDR-FELT15", "qty_per_unit": 1.15}]', 0.15, 75.00, 'roof_underlayment', 'RFG FELT'),
('RFG-FELT-30', '12-03', 'Install #30 Felt Underlayment', 'Install #30 asphalt felt underlayment', 'SQ', 28.00, 12.00, 40.00, 0.20, 'ROOF', '[{"sku": "MAT-UNDR-FELT30", "qty_per_unit": 1.15}]', 0.15, 75.00, 'roof_underlayment', 'RFG FELT+'),
('RFG-SYNTH', '12-03', 'Install Synthetic Underlayment', 'Install synthetic roof underlayment', 'SQ', 55.00, 12.00, 67.00, 0.20, 'ROOF', '[{"sku": "MAT-UNDR-SYNTH", "qty_per_unit": 1.15}]', 0.15, 100.00, 'roof_underlayment', 'RFG SYN'),
('RFG-ICE', '12-03', 'Install Ice & Water Shield', 'Install self-adhering ice and water shield membrane', 'SQ', 95.00, 18.00, 113.00, 0.30, 'ROOF', '[{"sku": "MAT-UNDR-ICE", "qty_per_unit": 1.10}]', 0.10, 75.00, 'roof_underlayment', 'RFG ICE'),

-- Shingles
('RFG-SHNG-3TAB', '12-04', 'Install 3-Tab Asphalt Shingles', 'Remove and replace 3-tab asphalt shingles (20-25 year)', 'SQ', 95.00, 75.00, 170.00, 1.25, 'ROOF', '[{"sku": "MAT-SHNG-3TAB", "qty_per_unit": 1.15}]', 0.15, 300.00, 'asphalt_3tab_shingle', 'RFG 3TB'),
('RFG-SHNG-ARCH', '12-04', 'Install Architectural Shingles', 'Remove and replace laminated/architectural asphalt shingles (30 year)', 'SQ', 135.00, 85.00, 220.00, 1.40, 'ROOF', '[{"sku": "MAT-SHNG-ARCH", "qty_per_unit": 1.15}]', 0.15, 350.00, 'asphalt_laminated_shingle', 'RFG LAM'),
('RFG-SHNG-PREM', '12-04', 'Install Premium Designer Shingles', 'Remove and replace premium designer shingles (50 year)', 'SQ', 275.00, 110.00, 385.00, 1.80, 'ROOF', '[{"sku": "MAT-SHNG-PREM", "qty_per_unit": 1.15}]', 0.15, 500.00, 'asphalt_premium_shingle', 'RFG DES'),
('RFG-RIDGE', '12-04', 'Install Hip & Ridge Cap', 'Install hip and ridge cap shingles', 'LF', 2.85, 2.50, 5.35, 0.04, 'ROOF', '[{"sku": "MAT-SHNG-RIDGE", "qty_per_unit": 1.10}]', 0.10, 75.00, 'asphalt_laminated_shingle', 'RFG HRC'),
('RFG-STARTER', '12-04', 'Install Starter Strip', 'Install starter strip shingles at eaves and rakes', 'LF', 1.25, 0.75, 2.00, 0.012, 'ROOF', '[{"sku": "MAT-SHNG-STARTER", "qty_per_unit": 1.10}]', 0.10, 50.00, 'asphalt_laminated_shingle', 'RFG STA'),

-- Flashing
('RFG-DRIP', '12-05', 'Install Drip Edge', 'Install aluminum drip edge at eaves and rakes', 'LF', 1.75, 1.25, 3.00, 0.02, 'ROOF', '[{"sku": "MAT-FLASH-DRIP", "qty_per_unit": 1.05}]', 0.05, 50.00, 'roof_flashing', 'RFG DRP'),
('RFG-VALLEY', '12-05', 'Install Valley Flashing', 'Install aluminum valley flashing (20" wide)', 'LF', 3.25, 4.50, 7.75, 0.075, 'ROOF', '[{"sku": "MAT-FLASH-VALLEY", "qty_per_unit": 1.05}]', 0.05, 75.00, 'roof_flashing', 'RFG VLY'),
('RFG-STEP', '12-05', 'Install Step Flashing', 'Install step flashing at roof-to-wall intersections', 'LF', 4.50, 6.00, 10.50, 0.10, 'ROOF', '[{"sku": "MAT-FLASH-STEP", "qty_per_unit": 3.00}]', 0.00, 50.00, 'roof_flashing', 'RFG STP'),
('RFG-PIPE', '12-05', 'Install Pipe Boot/Jack', 'Install pipe boot flashing for plumbing vents', 'EA', 15.00, 25.00, 40.00, 0.40, 'ROOF', '[{"sku": "MAT-FLASH-PIPE", "qty_per_unit": 1.00}]', 0.00, 40.00, 'roof_flashing', 'RFG PIPE'),

-- Ventilation
('RFG-VENT-RIDGE', '12-06', 'Install Ridge Vent', 'Install shingle-over ridge vent', 'LF', 4.50, 3.50, 8.00, 0.06, 'ROOF', '[{"sku": "MAT-VENT-RIDGE", "qty_per_unit": 1.05}]', 0.05, 75.00, 'asphalt_laminated_shingle', 'RFG RVN'),
('RFG-VENT-BOX', '12-06', 'Install Box/Louver Vent', 'Install static box/louver roof vent', 'EA', 35.00, 45.00, 80.00, 0.75, 'ROOF', '[{"sku": "MAT-VENT-BOX", "qty_per_unit": 1.00}]', 0.00, 80.00, 'asphalt_laminated_shingle', 'RFG BXV'),
('RFG-VENT-TURB', '12-06', 'Install Turbine Vent', 'Install wind-driven turbine vent', 'EA', 55.00, 65.00, 120.00, 1.00, 'ROOF', '[{"sku": "MAT-VENT-TURB", "qty_per_unit": 1.00}]', 0.00, 120.00, 'asphalt_laminated_shingle', 'RFG TRB'),

-- Gutters
('RFG-GUTR-5', '12-07', 'Install 5" Aluminum Gutter', 'Install 5" seamless aluminum K-style gutter', 'LF', 4.50, 5.50, 10.00, 0.09, 'ROOF', '[{"sku": "MAT-GUTR-5ALU", "qty_per_unit": 1.05}]', 0.05, 150.00, 'gutters_aluminum', 'GTR 5"K'),
('RFG-GUTR-6', '12-07', 'Install 6" Aluminum Gutter', 'Install 6" seamless aluminum K-style gutter', 'LF', 6.00, 6.50, 12.50, 0.10, 'ROOF', '[{"sku": "MAT-GUTR-6ALU", "qty_per_unit": 1.05}]', 0.05, 175.00, 'gutters_aluminum', 'GTR 6"K'),
('RFG-DSPT-2X3', '12-07', 'Install 2x3 Downspout', 'Install 2x3 aluminum downspout', 'LF', 3.50, 4.00, 7.50, 0.065, 'ROOF', '[{"sku": "MAT-GUTR-DSPT2X3", "qty_per_unit": 1.05}]', 0.05, 50.00, 'gutters_aluminum', 'GTR DSP'),
('RFG-DSPT-3X4', '12-07', 'Install 3x4 Downspout', 'Install 3x4 aluminum downspout', 'LF', 5.00, 4.50, 9.50, 0.075, 'ROOF', '[{"sku": "MAT-GUTR-DSPT3X4", "qty_per_unit": 1.05}]', 0.05, 50.00, 'gutters_aluminum', 'GTR DSP+'),

-- ============================================
-- WATER MITIGATION LINE ITEMS
-- ============================================

('WTR-EMERG', '01-01', 'Emergency Response/Service Call', 'Emergency response and initial assessment', 'EA', 0.00, 175.00, 175.00, 2.50, 'MITI', NULL, 0.00, 175.00, 'water_mitigation', 'WTR EMER'),
('WTR-EXTRACT-PORT', '01-02', 'Water Extraction - Portable', 'Extract standing water using portable extractor', 'SF', 0.00, 0.45, 0.45, 0.008, 'MITI', NULL, 0.00, 150.00, 'water_mitigation', 'WTR EXTP'),
('WTR-EXTRACT-TRUCK', '01-02', 'Water Extraction - Truck Mount', 'Extract standing water using truck-mounted extractor', 'SF', 0.00, 0.35, 0.35, 0.006, 'MITI', NULL, 0.00, 250.00, 'water_mitigation', 'WTR EXTM'),
('WTR-EXTRACT-SUB', '01-02', 'Water Extraction - Subfloor', 'Extract water from subfloor/wall cavities', 'SF', 0.00, 0.75, 0.75, 0.012, 'MITI', NULL, 0.00, 200.00, 'water_mitigation', 'WTR EXTS'),

('WTR-DEHU-LGR', '01-03', 'Dehumidifier - LGR (per day)', 'LGR dehumidifier setup and daily monitoring', 'DAY', 85.00, 25.00, 110.00, 0.40, 'MITI', '[{"sku": "MAT-MITI-DEHULG", "qty_per_unit": 1.00}]', 0.00, 110.00, 'water_mitigation', 'WTR DLGR'),
('WTR-DEHU-CON', '01-03', 'Dehumidifier - Conventional (per day)', 'Conventional dehumidifier setup and daily monitoring', 'DAY', 55.00, 20.00, 75.00, 0.30, 'MITI', '[{"sku": "MAT-MITI-DEHUCON", "qty_per_unit": 1.00}]', 0.00, 75.00, 'water_mitigation', 'WTR DCON'),
('WTR-AIRMOV', '01-03', 'Air Mover (per day)', 'Air mover/fan setup and daily monitoring', 'DAY', 35.00, 15.00, 50.00, 0.25, 'MITI', '[{"sku": "MAT-MITI-AIRMOV", "qty_per_unit": 1.00}]', 0.00, 50.00, 'water_mitigation', 'WTR AMOV'),
('WTR-HEPA', '01-03', 'HEPA Air Scrubber (per day)', 'HEPA air filtration device setup and daily monitoring', 'DAY', 125.00, 25.00, 150.00, 0.40, 'MITI', '[{"sku": "MAT-MITI-HEPA", "qty_per_unit": 1.00}]', 0.00, 150.00, 'water_mitigation', 'WTR HEPA'),
('WTR-INJECT', '01-03', 'Injection Drying System (per day)', 'Inject drying system for walls/floors', 'DAY', 95.00, 35.00, 130.00, 0.50, 'MITI', '[{"sku": "MAT-MITI-INJECT", "qty_per_unit": 1.00}]', 0.00, 130.00, 'water_mitigation', 'WTR INJD'),

('WTR-MOIST-INIT', '01-04', 'Moisture Inspection - Initial', 'Initial moisture mapping and documentation', 'EA', 0.00, 125.00, 125.00, 1.75, 'MITI', NULL, 0.00, 125.00, 'water_mitigation', 'WTR MSTI'),
('WTR-MOIST-DAILY', '01-04', 'Moisture Monitoring - Daily', 'Daily moisture readings and documentation', 'DAY', 0.00, 45.00, 45.00, 0.60, 'MITI', NULL, 0.00, 45.00, 'water_mitigation', 'WTR MSTD'),

('WTR-CONTENT-MOVE', '01-05', 'Content Manipulation - Move Out', 'Move contents to allow for drying/repairs', 'HR', 0.00, 45.00, 45.00, 1.00, 'GEN', NULL, 0.00, 90.00, 'water_mitigation', 'WTR CMOV'),
('WTR-CONTENT-BACK', '01-05', 'Content Manipulation - Move Back', 'Move contents back after repairs complete', 'HR', 0.00, 45.00, 45.00, 1.00, 'GEN', NULL, 0.00, 90.00, 'water_mitigation', 'WTR CMBK'),

('WTR-ANTIMICRO', '01-06', 'Antimicrobial Treatment', 'Apply antimicrobial treatment to affected surfaces', 'SF', 0.35, 0.25, 0.60, 0.004, 'MITI', '[{"sku": "MAT-MITI-ANTIMICRO", "qty_per_unit": 0.01}]', 0.00, 75.00, 'water_mitigation', 'WTR ANTI'),

-- ============================================
-- DEMOLITION LINE ITEMS
-- ============================================

('DEM-DRY-FLOOD2', '02-01', 'Drywall Removal - Flood Cut 2ft', 'Remove drywall flood cut at 2 feet from floor', 'LF', 0.00, 2.50, 2.50, 0.04, 'DEMO', NULL, 0.00, 75.00, NULL, 'DEM DW2'),
('DEM-DRY-FLOOD4', '02-01', 'Drywall Removal - Flood Cut 4ft', 'Remove drywall flood cut at 4 feet from floor', 'LF', 0.00, 4.50, 4.50, 0.075, 'DEMO', NULL, 0.00, 100.00, NULL, 'DEM DW4'),
('DEM-DRY-FULL', '02-01', 'Drywall Removal - Full Height', 'Remove drywall full height (floor to ceiling)', 'SF', 0.00, 0.65, 0.65, 0.011, 'DEMO', NULL, 0.00, 100.00, NULL, 'DEM DWF'),
('DEM-DRY-CEIL', '02-01', 'Drywall Removal - Ceiling', 'Remove ceiling drywall', 'SF', 0.00, 0.85, 0.85, 0.014, 'DEMO', NULL, 0.00, 100.00, NULL, 'DEM DWC'),
('DEM-INSUL', '02-01', 'Insulation Removal', 'Remove damaged insulation from walls/ceilings', 'SF', 0.00, 0.45, 0.45, 0.008, 'DEMO', NULL, 0.00, 75.00, NULL, 'DEM INS'),
('DEM-BASE', '02-01', 'Baseboard Removal', 'Remove baseboard trim', 'LF', 0.00, 0.75, 0.75, 0.012, 'DEMO', NULL, 0.00, 25.00, NULL, 'DEM BSE'),
('DEM-FLOOR-CARP', '02-01', 'Flooring Removal - Carpet & Pad', 'Remove carpet and pad', 'SF', 0.00, 0.35, 0.35, 0.006, 'DEMO', NULL, 0.00, 50.00, NULL, 'DEM CRPT'),
('DEM-FLOOR-TILE', '02-01', 'Flooring Removal - Tile', 'Remove ceramic/vinyl tile flooring', 'SF', 0.00, 1.50, 1.50, 0.025, 'DEMO', NULL, 0.00, 100.00, NULL, 'DEM TIL'),
('DEM-FLOOR-VINYL', '02-01', 'Flooring Removal - Sheet Vinyl', 'Remove sheet vinyl flooring', 'SF', 0.00, 0.65, 0.65, 0.011, 'DEMO', NULL, 0.00, 75.00, NULL, 'DEM VNL'),

('DEM-HAUL', '02-02', 'Debris Hauling', 'Haul debris to dumpster/disposal', 'HR', 0.00, 45.00, 45.00, 1.00, 'GEN', NULL, 0.00, 45.00, NULL, 'DEM HAUL'),
('DEM-DUMP', '02-02', 'Dumpster Rental (per week)', 'Dumpster rental including delivery and pickup', 'WK', 450.00, 0.00, 450.00, 0.00, 'GEN', NULL, 0.00, 450.00, NULL, 'DEM DMPW'),
('DEM-CONTAIN', '02-03', 'Containment Barrier Setup', 'Install plastic containment barriers', 'SF', 0.15, 0.35, 0.50, 0.006, 'DEMO', '[{"sku": "MAT-MITI-PLASTIC", "qty_per_unit": 1.20}]', 0.20, 75.00, NULL, 'DEM CONT'),

-- ============================================
-- DRYWALL LINE ITEMS
-- ============================================

('DRY-HTT-12', '06-02', 'Drywall - Hang, Tape, Texture 1/2"', 'Install 1/2" drywall - hang, tape, and texture', 'SF', 0.45, 2.25, 2.70, 0.038, 'DRYWALL', '[{"sku": "MAT-DRY-REG12", "qty_per_unit": 1.10}, {"sku": "MAT-DRY-TAPE", "qty_per_unit": 0.50}, {"sku": "MAT-DRY-MUD", "qty_per_unit": 0.02}]', 0.10, 150.00, 'drywall', 'DW HTT'),
('DRY-HTT-58', '06-02', 'Drywall - Hang, Tape, Texture 5/8"', 'Install 5/8" drywall - hang, tape, and texture', 'SF', 0.55, 2.35, 2.90, 0.040, 'DRYWALL', '[{"sku": "MAT-DRY-REG58", "qty_per_unit": 1.10}, {"sku": "MAT-DRY-TAPE", "qty_per_unit": 0.50}, {"sku": "MAT-DRY-MUD", "qty_per_unit": 0.02}]', 0.10, 150.00, 'drywall', 'DW HTT+'),
('DRY-HTT-MR', '06-02', 'Drywall - Hang, Tape, Texture Moisture Resistant', 'Install moisture resistant drywall - HTT', 'SF', 0.65, 2.35, 3.00, 0.040, 'DRYWALL', '[{"sku": "MAT-DRY-MR12", "qty_per_unit": 1.10}, {"sku": "MAT-DRY-TAPE", "qty_per_unit": 0.50}, {"sku": "MAT-DRY-MUD", "qty_per_unit": 0.02}]', 0.10, 175.00, 'drywall', 'DW HTTMR'),
('DRY-HTT-FIRE', '06-02', 'Drywall - Hang, Tape, Texture Type X', 'Install 5/8" Type X fire-rated drywall - HTT', 'SF', 0.60, 2.45, 3.05, 0.042, 'DRYWALL', '[{"sku": "MAT-DRY-FIRE58", "qty_per_unit": 1.10}, {"sku": "MAT-DRY-TAPE", "qty_per_unit": 0.50}, {"sku": "MAT-DRY-MUD", "qty_per_unit": 0.02}]', 0.10, 175.00, 'drywall', 'DW HTTFR'),
('DRY-HTT-CEIL', '06-02', 'Drywall - Hang, Tape, Texture Ceiling', 'Install ceiling drywall - hang, tape, and texture', 'SF', 0.55, 2.85, 3.40, 0.048, 'DRYWALL', '[{"sku": "MAT-DRY-REG12", "qty_per_unit": 1.10}, {"sku": "MAT-DRY-TAPE", "qty_per_unit": 0.50}, {"sku": "MAT-DRY-MUD", "qty_per_unit": 0.02}]', 0.10, 200.00, 'drywall', 'DW HTTCL'),

('DRY-TAPE', '06-03', 'Drywall - Tape and Finish Only', 'Tape and finish drywall (no hanging)', 'SF', 0.15, 1.25, 1.40, 0.021, 'DRYWALL', '[{"sku": "MAT-DRY-TAPE", "qty_per_unit": 0.50}, {"sku": "MAT-DRY-MUD", "qty_per_unit": 0.02}]', 0.00, 100.00, 'drywall', 'DW TF'),
('DRY-TEXTURE', '06-03', 'Drywall - Texture Match', 'Match existing texture (knockdown, orange peel, etc.)', 'SF', 0.10, 0.85, 0.95, 0.014, 'DRYWALL', NULL, 0.00, 75.00, 'drywall', 'DW TXM'),
('DRY-SKIM', '06-03', 'Drywall - Skim Coat', 'Apply skim coat to smooth walls', 'SF', 0.15, 1.45, 1.60, 0.024, 'DRYWALL', '[{"sku": "MAT-DRY-MUD", "qty_per_unit": 0.03}]', 0.00, 100.00, 'drywall', 'DW SKM'),
('DRY-CORNER', '06-03', 'Drywall - Corner Bead', 'Install and finish metal corner bead', 'LF', 0.75, 2.25, 3.00, 0.038, 'DRYWALL', '[{"sku": "MAT-DRY-CORNER", "qty_per_unit": 1.05}]', 0.05, 25.00, 'drywall', 'DW CBE'),

('DRY-PATCH-SM', '06-04', 'Drywall Repair - Small Patch (up to 12")', 'Patch small hole up to 12 inches', 'EA', 5.00, 35.00, 40.00, 0.50, 'DRYWALL', NULL, 0.00, 40.00, 'drywall', 'DW PTS'),
('DRY-PATCH-MED', '06-04', 'Drywall Repair - Medium Patch (12-24")', 'Patch medium hole 12-24 inches', 'EA', 10.00, 55.00, 65.00, 0.80, 'DRYWALL', NULL, 0.00, 65.00, 'drywall', 'DW PTM'),
('DRY-PATCH-LG', '06-04', 'Drywall Repair - Large Patch (24-48")', 'Patch large area 24-48 inches', 'EA', 20.00, 85.00, 105.00, 1.20, 'DRYWALL', NULL, 0.00, 105.00, 'drywall', 'DW PTL'),

-- ============================================
-- INTERIOR PAINTING LINE ITEMS
-- ============================================

('PNT-WALL-1CT', '14-01', 'Paint Walls - 1 Coat', 'Paint walls, 1 coat (recoat/touch-up)', 'SF', 0.08, 0.32, 0.40, 0.005, 'PAINT', '[{"sku": "MAT-PAINT-EGG", "qty_per_unit": 0.003}]', 0.00, 75.00, 'interior_paint', 'PNT W1'),
('PNT-WALL-2CT', '14-01', 'Paint Walls - 2 Coats', 'Paint walls, 2 coats', 'SF', 0.14, 0.56, 0.70, 0.009, 'PAINT', '[{"sku": "MAT-PAINT-EGG", "qty_per_unit": 0.006}]', 0.00, 100.00, 'interior_paint', 'PNT W2'),
('PNT-WALL-SEMI', '14-01', 'Paint Walls - 2 Coats Semi-Gloss', 'Paint walls, 2 coats semi-gloss (kitchen/bath)', 'SF', 0.16, 0.59, 0.75, 0.010, 'PAINT', '[{"sku": "MAT-PAINT-SEMI", "qty_per_unit": 0.006}]', 0.00, 100.00, 'interior_paint', 'PNT W2S'),

('PNT-CEIL-1CT', '14-02', 'Paint Ceiling - 1 Coat', 'Paint ceiling, 1 coat', 'SF', 0.07, 0.38, 0.45, 0.006, 'PAINT', '[{"sku": "MAT-PAINT-CEIL", "qty_per_unit": 0.003}]', 0.00, 75.00, 'interior_paint', 'PNT C1'),
('PNT-CEIL-2CT', '14-02', 'Paint Ceiling - 2 Coats', 'Paint ceiling, 2 coats', 'SF', 0.12, 0.68, 0.80, 0.011, 'PAINT', '[{"sku": "MAT-PAINT-CEIL", "qty_per_unit": 0.006}]', 0.00, 100.00, 'interior_paint', 'PNT C2'),

('PNT-TRIM', '14-03', 'Paint Trim/Baseboard', 'Paint trim, baseboard, or crown molding', 'LF', 0.15, 0.85, 1.00, 0.014, 'PAINT', '[{"sku": "MAT-PAINT-SEMI", "qty_per_unit": 0.002}]', 0.00, 50.00, 'interior_paint', 'PNT TRM'),
('PNT-DOOR', '14-03', 'Paint Door (both sides)', 'Paint interior door, both sides', 'EA', 8.00, 42.00, 50.00, 0.65, 'PAINT', '[{"sku": "MAT-PAINT-SEMI", "qty_per_unit": 0.15}]', 0.00, 50.00, 'interior_paint', 'PNT DR'),
('PNT-DOORFRAME', '14-03', 'Paint Door Frame/Jamb', 'Paint door frame and jamb', 'EA', 3.00, 22.00, 25.00, 0.35, 'PAINT', '[{"sku": "MAT-PAINT-SEMI", "qty_per_unit": 0.05}]', 0.00, 25.00, 'interior_paint', 'PNT DRF'),
('PNT-WINDOW', '14-03', 'Paint Window Trim', 'Paint window trim and sill', 'EA', 4.00, 26.00, 30.00, 0.40, 'PAINT', '[{"sku": "MAT-PAINT-SEMI", "qty_per_unit": 0.06}]', 0.00, 30.00, 'interior_paint', 'PNT WNT'),

('PNT-PRIME-STD', '14-04', 'Primer - Standard', 'Apply standard primer (PVA)', 'SF', 0.06, 0.29, 0.35, 0.005, 'PAINT', '[{"sku": "MAT-PRIME-STD", "qty_per_unit": 0.003}]', 0.00, 75.00, 'interior_paint', 'PNT PRS'),
('PNT-PRIME-STAIN', '14-04', 'Primer - Stain Blocking', 'Apply stain-blocking primer (smoke/water stains)', 'SF', 0.10, 0.35, 0.45, 0.006, 'PAINT', '[{"sku": "MAT-PRIME-STAIN", "qty_per_unit": 0.003}]', 0.00, 100.00, 'interior_paint', 'PNT PRB'),
('PNT-PRIME-MOLD', '14-04', 'Primer - Mold Resistant', 'Apply mold-resistant primer', 'SF', 0.12, 0.38, 0.50, 0.006, 'PAINT', '[{"sku": "MAT-PRIME-MOLD", "qty_per_unit": 0.003}]', 0.00, 100.00, 'interior_paint', 'PNT PRM'),

-- ============================================
-- FLOORING LINE ITEMS
-- ============================================

('FLR-CARP', '09', 'Install Carpet with Pad', 'Install carpet with pad (mid-grade)', 'SY', 34.00, 8.00, 42.00, 0.13, 'FLOOR', '[{"sku": "MAT-FLR-CARP", "qty_per_unit": 1.10}, {"sku": "MAT-FLR-PAD", "qty_per_unit": 1.10}]', 0.10, 200.00, 'carpet', 'FLR CPT'),
('FLR-LVP', '09', 'Install Luxury Vinyl Plank', 'Install luxury vinyl plank flooring (mid-grade)', 'SF', 3.50, 2.50, 6.00, 0.040, 'FLOOR', '[{"sku": "MAT-FLR-LVP", "qty_per_unit": 1.10}]', 0.10, 200.00, 'lvp_flooring', 'FLR LVP'),
('FLR-LAM', '09', 'Install Laminate Flooring', 'Install laminate plank flooring (mid-grade)', 'SF', 2.75, 2.25, 5.00, 0.038, 'FLOOR', '[{"sku": "MAT-FLR-LAM", "qty_per_unit": 1.10}]', 0.10, 200.00, 'laminate_flooring', 'FLR LAM'),
('FLR-TILE', '09', 'Install Ceramic Tile', 'Install ceramic tile flooring (standard)', 'SF', 4.00, 6.50, 10.50, 0.108, 'FLOOR', '[{"sku": "MAT-FLR-TILE", "qty_per_unit": 1.15}]', 0.15, 300.00, 'ceramic_tile', 'FLR TIL'),
('FLR-HARDWD', '09', 'Install Hardwood Flooring', 'Install solid hardwood flooring (oak)', 'SF', 8.00, 5.50, 13.50, 0.092, 'FLOOR', '[{"sku": "MAT-FLR-HARDWD", "qty_per_unit": 1.10}]', 0.10, 400.00, 'hardwood_flooring', 'FLR HWD'),

-- ============================================
-- FENCING LINE ITEMS
-- ============================================

('FNC-WOOD', '32', 'Install Wood Privacy Fence', 'Install 6ft cedar privacy fence', 'LF', 22.00, 18.00, 40.00, 0.30, 'FENCE', '[{"sku": "MAT-FENCE-WOOD", "qty_per_unit": 1.10}]', 0.10, 250.00, 'fence_wood', 'FNC WDP'),
('FNC-CLINK', '32', 'Install Chain Link Fence', 'Install 4ft galvanized chain link fence', 'LF', 12.00, 10.00, 22.00, 0.17, 'FENCE', '[{"sku": "MAT-FENCE-CLINK", "qty_per_unit": 1.05}]', 0.05, 200.00, 'fence_chain_link', 'FNC CHL'),
('FNC-VINYL', '32', 'Install Vinyl Privacy Fence', 'Install 6ft vinyl privacy fence', 'LF', 28.00, 15.00, 43.00, 0.25, 'FENCE', '[{"sku": "MAT-FENCE-VINYL", "qty_per_unit": 1.05}]', 0.05, 300.00, 'fence_vinyl', 'FNC VNL'),
('FNC-POST', '32', 'Install Fence Post', 'Install 4x4 treated fence post with concrete', 'EA', 25.00, 35.00, 60.00, 0.58, 'FENCE', '[{"sku": "MAT-FENCE-POST", "qty_per_unit": 1.00}]', 0.00, 60.00, 'fence_wood', 'FNC PST'),

-- ============================================
-- GENERAL CONDITIONS
-- ============================================

('GEN-PERMIT', '99', 'Building Permit', 'Building permit fees', 'EA', 0.00, 0.00, 0.00, 0.00, NULL, NULL, 0.00, 0.00, NULL, NULL),
('GEN-SUPER', '99', 'Job Supervision', 'Project supervision and coordination', 'HR', 0.00, 65.00, 65.00, 1.00, NULL, NULL, 0.00, 0.00, NULL, NULL),
('GEN-CLEAN-ROUGH', '99', 'Rough Cleaning', 'Rough cleaning during construction', 'SF', 0.00, 0.15, 0.15, 0.002, 'GEN', NULL, 0.00, 50.00, NULL, 'CLN RGH'),
('GEN-CLEAN-FINAL', '99', 'Final Cleaning', 'Final cleaning after construction', 'SF', 0.00, 0.25, 0.25, 0.004, 'GEN', NULL, 0.00, 75.00, NULL, 'CLN FNL');
```

---

## Part 6: Damage Areas (Spatial Hierarchy)

```sql
-- Damage areas linked to Sketch zones
CREATE TABLE damage_areas (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  estimate_id UUID NOT NULL,               -- FK to estimates table
  parent_area_id UUID REFERENCES damage_areas(id),
  sketch_zone_id UUID,                     -- FK to your Sketch damage zone
  
  name VARCHAR(100) NOT NULL,              -- 'Roof1', 'Kitchen', 'Master Bath'
  area_type VARCHAR(50) NOT NULL,          -- 'structure', 'floor', 'room', 'exterior', 'component'
  
  -- Measurements from Sketch
  measurements JSONB,                       -- See structure below
  
  -- Photos
  photo_ids JSONB,                         -- Array of photo IDs
  
  sort_order INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Example measurements structure:
-- {
--   "surface_area_sf": 2610.84,
--   "perimeter_lf": 211.56,
--   "pitch": "6/12",
--   "squares": 26.11,
--   "hip_length_lf": 11.23,
--   "ridge_length_lf": 108.42,
--   "valley_length_lf": 45.00,
--   "eave_length_lf": 156.00,
--   "rake_length_lf": 55.56,
--   "height_ft": 8.5,
--   "width_ft": 12.0,
--   "length_ft": 15.0
-- }

-- Default area hierarchy template
INSERT INTO damage_areas (id, estimate_id, parent_area_id, name, area_type, sort_order) VALUES
-- These are templates - actual values created per estimate
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', NULL, 'House', 'structure', 1);
```

---

## Part 7: Estimates & Line Item Tables

```sql
-- Main estimates table
CREATE TABLE estimates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  claim_id UUID NOT NULL,                  -- FK to your claims table
  
  -- Versioning
  version INTEGER DEFAULT 1,
  status VARCHAR(30) DEFAULT 'draft',      -- 'draft', 'submitted', 'approved', 'paid'
  
  -- Pricing context
  price_list_id UUID REFERENCES price_lists(id),
  region_code VARCHAR(20) NOT NULL,
  carrier_profile_id UUID REFERENCES carrier_profiles(id),
  
  -- Property info
  property_address TEXT,
  property_zip VARCHAR(10),
  date_of_loss DATE,
  date_inspected DATE,
  
  -- Age/condition for depreciation
  year_built INTEGER,
  roof_age_years INTEGER,
  overall_condition VARCHAR(20) DEFAULT 'Average',  -- 'Good', 'Average', 'Poor'
  
  -- Deductibles
  deductible_cov_a DECIMAL(10,2) DEFAULT 0,
  deductible_cov_b DECIMAL(10,2) DEFAULT 0,
  deductible_cov_c DECIMAL(10,2) DEFAULT 0,
  
  -- Calculated totals (denormalized for performance)
  subtotal_materials DECIMAL(12,2) DEFAULT 0,
  subtotal_labor DECIMAL(12,2) DEFAULT 0,
  subtotal_equipment DECIMAL(12,2) DEFAULT 0,
  subtotal_before_op DECIMAL(12,2) DEFAULT 0,
  overhead_amount DECIMAL(12,2) DEFAULT 0,
  profit_amount DECIMAL(12,2) DEFAULT 0,
  tax_amount DECIMAL(12,2) DEFAULT 0,
  total_rcv DECIMAL(12,2) DEFAULT 0,
  total_depreciation DECIMAL(12,2) DEFAULT 0,
  total_acv DECIMAL(12,2) DEFAULT 0,
  recoverable_depreciation DECIMAL(12,2) DEFAULT 0,
  non_recoverable_depreciation DECIMAL(12,2) DEFAULT 0,
  
  -- Net claim
  net_claim_cov_a DECIMAL(12,2) DEFAULT 0,
  net_claim_cov_b DECIMAL(12,2) DEFAULT 0,
  net_claim_cov_c DECIMAL(12,2) DEFAULT 0,
  net_claim_total DECIMAL(12,2) DEFAULT 0,
  
  -- Metadata
  created_by UUID,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  submitted_at TIMESTAMP,
  approved_at TIMESTAMP
);

-- Estimate line items
CREATE TABLE estimate_line_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  estimate_id UUID NOT NULL REFERENCES estimates(id) ON DELETE CASCADE,
  line_item_id UUID REFERENCES line_items(id),
  damage_area_id UUID REFERENCES damage_areas(id),
  
  -- Line item details (copied from line_items for historical accuracy)
  line_number INTEGER NOT NULL,
  code VARCHAR(30) NOT NULL,
  description TEXT NOT NULL,
  category_code VARCHAR(10),
  
  -- Quantity and pricing
  quantity DECIMAL(12,4) NOT NULL,
  unit_of_measure VARCHAR(20) NOT NULL,
  unit_price DECIMAL(10,2) NOT NULL,
  
  -- Cost breakdown
  material_cost DECIMAL(10,2) DEFAULT 0,
  labor_cost DECIMAL(10,2) DEFAULT 0,
  equipment_cost DECIMAL(10,2) DEFAULT 0,
  
  -- Adjustments
  waste_factor DECIMAL(4,2) DEFAULT 0,
  waste_amount DECIMAL(10,2) DEFAULT 0,
  
  -- Calculated RCV
  line_rcv DECIMAL(10,2) NOT NULL,
  tax_amount DECIMAL(10,2) DEFAULT 0,
  line_total_with_tax DECIMAL(10,2) NOT NULL,
  
  -- Depreciation
  age_years INTEGER,
  useful_life_years INTEGER,
  condition VARCHAR(20) DEFAULT 'Average',
  depreciation_pct DECIMAL(5,2) DEFAULT 0,
  depreciation_amount DECIMAL(10,2) DEFAULT 0,
  is_recoverable BOOLEAN DEFAULT true,
  acv DECIMAL(10,2) NOT NULL,
  
  -- Coverage assignment
  coverage_code VARCHAR(10) DEFAULT 'A',
  
  -- Notes
  notes TEXT,
  
  -- Audit
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Coverage summaries (one row per coverage type per estimate)
CREATE TABLE estimate_coverage_summary (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  estimate_id UUID NOT NULL REFERENCES estimates(id) ON DELETE CASCADE,
  coverage_code VARCHAR(10) NOT NULL,
  
  subtotal_rcv DECIMAL(12,2) DEFAULT 0,
  tax_amount DECIMAL(12,2) DEFAULT 0,
  overhead_amount DECIMAL(12,2) DEFAULT 0,
  profit_amount DECIMAL(12,2) DEFAULT 0,
  total_rcv DECIMAL(12,2) DEFAULT 0,
  
  recoverable_depreciation DECIMAL(12,2) DEFAULT 0,
  non_recoverable_depreciation DECIMAL(12,2) DEFAULT 0,
  total_depreciation DECIMAL(12,2) DEFAULT 0,
  
  total_acv DECIMAL(12,2) DEFAULT 0,
  deductible DECIMAL(12,2) DEFAULT 0,
  net_claim DECIMAL(12,2) DEFAULT 0,
  
  UNIQUE(estimate_id, coverage_code)
);

-- Create indexes
CREATE INDEX idx_estimates_claim ON estimates(claim_id);
CREATE INDEX idx_estimates_status ON estimates(status);
CREATE INDEX idx_estimate_line_items_estimate ON estimate_line_items(estimate_id);
CREATE INDEX idx_estimate_line_items_category ON estimate_line_items(category_code);
CREATE INDEX idx_damage_areas_estimate ON damage_areas(estimate_id);
```

---

## Part 8: Estimate Calculation Engine

Create the TypeScript service:

```typescript
// server/services/estimateCalculator.ts

import { db } from '../db';
import { 
  estimates, 
  estimateLineItems, 
  estimateCoverageSummary,
  lineItems, 
  materials,
  laborRates, 
  regionalMultipliers, 
  carrierProfiles,
  taxRates,
  depreciationSchedules,
  coverageTypes
} from '../db/schema';
import { eq, and, inArray } from 'drizzle-orm';

// Types
interface LineItemInput {
  lineItemCode: string;
  quantity: number;
  damageAreaId?: string;
  coverageCode?: string;
  ageYears?: number;
  condition?: 'Good' | 'Average' | 'Poor';
  notes?: string;
}

interface EstimateInput {
  claimId: string;
  regionCode: string;
  carrierProfileId?: string;
  priceListId?: string;
  propertyAddress?: string;
  propertyZip?: string;
  dateOfLoss?: Date;
  yearBuilt?: number;
  roofAgeYears?: number;
  overallCondition?: 'Good' | 'Average' | 'Poor';
  deductibleCovA?: number;
  deductibleCovB?: number;
  deductibleCovC?: number;
  lineItems: LineItemInput[];
}

interface CalculatedLineItem {
  lineItemCode: string;
  description: string;
  categoryCode: string;
  quantity: number;
  unitOfMeasure: string;
  unitPrice: number;
  materialCost: number;
  laborCost: number;
  equipmentCost: number;
  wasteFactor: number;
  wasteAmount: number;
  lineRcv: number;
  taxAmount: number;
  lineTotalWithTax: number;
  ageYears: number;
  usefulLifeYears: number;
  condition: string;
  depreciationPct: number;
  depreciationAmount: number;
  isRecoverable: boolean;
  acv: number;
  coverageCode: string;
  damageAreaId?: string;
  notes?: string;
}

interface CoverageSummary {
  coverageCode: string;
  subtotalRcv: number;
  taxAmount: number;
  overheadAmount: number;
  profitAmount: number;
  totalRcv: number;
  recoverableDepreciation: number;
  nonRecoverableDepreciation: number;
  totalDepreciation: number;
  totalAcv: number;
  deductible: number;
  netClaim: number;
}

interface EstimateResult {
  lineItems: CalculatedLineItem[];
  coverageSummaries: CoverageSummary[];
  totals: {
    subtotalMaterials: number;
    subtotalLabor: number;
    subtotalEquipment: number;
    subtotalBeforeOp: number;
    overheadAmount: number;
    profitAmount: number;
    taxAmount: number;
    totalRcv: number;
    totalDepreciation: number;
    totalAcv: number;
    recoverableDepreciation: number;
    nonRecoverableDepreciation: number;
    netClaimCovA: number;
    netClaimCovB: number;
    netClaimCovC: number;
    netClaimTotal: number;
  };
  meta: {
    priceListCode: string;
    regionCode: string;
    carrierName: string;
    calculatedAt: Date;
    tradesInvolved: string[];
    qualifiesForOp: boolean;
  };
}

// Main calculation function
export async function calculateEstimate(input: EstimateInput): Promise<EstimateResult> {
  // 1. Load pricing context
  const [region] = await db
    .select()
    .from(regionalMultipliers)
    .where(eq(regionalMultipliers.regionCode, input.regionCode));
  
  if (!region) {
    throw new Error(`Region not found: ${input.regionCode}`);
  }
  
  const carrierProfileId = input.carrierProfileId || 'DEFAULT';
  const [carrier] = await db
    .select()
    .from(carrierProfiles)
    .where(eq(carrierProfiles.carrierCode, carrierProfileId));
  
  if (!carrier) {
    throw new Error(`Carrier profile not found: ${carrierProfileId}`);
  }
  
  // Load tax rates for region
  const taxes = await db
    .select()
    .from(taxRates)
    .where(and(
      eq(taxRates.regionCode, input.regionCode),
      eq(taxRates.isActive, true)
    ));
  
  const materialTaxRate = taxes.find(t => t.taxType === 'material_sales')?.rate || 0;
  
  // Load depreciation schedules
  const depSchedules = await db.select().from(depreciationSchedules);
  const depScheduleMap = new Map(depSchedules.map(d => [`${d.categoryCode}-${d.itemType}`, d]));
  
  // 2. Process each line item
  const calculatedItems: CalculatedLineItem[] = [];
  const tradesInvolved = new Set<string>();
  
  for (const itemInput of input.lineItems) {
    // Get line item definition
    const [lineItemDef] = await db
      .select()
      .from(lineItems)
      .where(eq(lineItems.code, itemInput.lineItemCode));
    
    if (!lineItemDef) {
      throw new Error(`Line item not found: ${itemInput.lineItemCode}`);
    }
    
    // Track trades
    if (lineItemDef.tradeCode) {
      tradesInvolved.add(lineItemDef.tradeCode);
    }
    
    // Apply regional multipliers
    const adjustedMaterialCost = (lineItemDef.baseMaterialCost || 0) * 
      Number(region.materialMultiplier) * itemInput.quantity;
    const adjustedLaborCost = (lineItemDef.baseLaborCost || 0) * 
      Number(region.laborMultiplier) * itemInput.quantity;
    const adjustedEquipmentCost = (lineItemDef.baseEquipmentCost || 0) * 
      Number(region.equipmentMultiplier) * itemInput.quantity;
    
    // Calculate waste
    const wasteFactor = Number(lineItemDef.wasteFactor) || 0;
    const baseLineTotal = adjustedMaterialCost + adjustedLaborCost + adjustedEquipmentCost;
    const wasteAmount = baseLineTotal * wasteFactor;
    
    // Line RCV before tax
    let lineRcv = baseLineTotal + wasteAmount;
    
    // Apply minimum charge
    const minCharge = Number(lineItemDef.minimumCharge) || 0;
    if (lineRcv < minCharge && lineRcv > 0) {
      lineRcv = minCharge;
    }
    
    // Calculate tax (on materials only typically)
    const taxableMaterialCost = adjustedMaterialCost * (1 + wasteFactor);
    const taxAmount = taxableMaterialCost * Number(materialTaxRate);
    
    const lineTotalWithTax = lineRcv + taxAmount;
    
    // Calculate depreciation
    const depKey = `${lineItemDef.categoryCode}-${lineItemDef.depreciationType}`;
    const depSchedule = depScheduleMap.get(depKey);
    
    let ageYears = itemInput.ageYears ?? input.roofAgeYears ?? 0;
    let usefulLifeYears = depSchedule?.usefulLifeYears ?? 0;
    let depreciationPct = 0;
    let depreciationAmount = 0;
    let isRecoverable = true;
    
    if (depSchedule && depSchedule.isDepreciable && usefulLifeYears > 0) {
      // Base depreciation
      depreciationPct = (ageYears / usefulLifeYears) * 100;
      
      // Condition adjustment
      const condition = itemInput.condition || input.overallCondition || 'Average';
      if (condition === 'Good') {
        depreciationPct *= Number(depSchedule.conditionAdjustmentGood);
      } else if (condition === 'Poor') {
        depreciationPct *= Number(depSchedule.conditionAdjustmentPoor);
      }
      
      // Cap at maximum
      const maxDep = Number(depSchedule.maxDepreciationPct);
      depreciationPct = Math.min(depreciationPct, maxDep);
      
      // Calculate amount
      depreciationAmount = lineTotalWithTax * (depreciationPct / 100);
    }
    
    const acv = lineTotalWithTax - depreciationAmount;
    const coverageCode = itemInput.coverageCode || lineItemDef.defaultCoverageCode || 'A';
    
    calculatedItems.push({
      lineItemCode: lineItemDef.code,
      description: lineItemDef.name,
      categoryCode: lineItemDef.categoryCode,
      quantity: itemInput.quantity,
      unitOfMeasure: lineItemDef.unitOfMeasure,
      unitPrice: Number(lineItemDef.unitPrice),
      materialCost: adjustedMaterialCost,
      laborCost: adjustedLaborCost,
      equipmentCost: adjustedEquipmentCost,
      wasteFactor,
      wasteAmount,
      lineRcv,
      taxAmount,
      lineTotalWithTax,
      ageYears,
      usefulLifeYears,
      condition: itemInput.condition || input.overallCondition || 'Average',
      depreciationPct,
      depreciationAmount,
      isRecoverable,
      acv,
      coverageCode,
      damageAreaId: itemInput.damageAreaId,
      notes: itemInput.notes
    });
  }
  
  // 3. Calculate O&P eligibility
  const qualifiesForOp = tradesInvolved.size >= carrier.opTradeMinimum;
  
  // 4. Aggregate by coverage
  const coverageMap = new Map<string, CoverageSummary>();
  
  for (const item of calculatedItems) {
    if (!coverageMap.has(item.coverageCode)) {
      coverageMap.set(item.coverageCode, {
        coverageCode: item.coverageCode,
        subtotalRcv: 0,
        taxAmount: 0,
        overheadAmount: 0,
        profitAmount: 0,
        totalRcv: 0,
        recoverableDepreciation: 0,
        nonRecoverableDepreciation: 0,
        totalDepreciation: 0,
        totalAcv: 0,
        deductible: 0,
        netClaim: 0
      });
    }
    
    const summary = coverageMap.get(item.coverageCode)!;
    summary.subtotalRcv += item.lineRcv;
    summary.taxAmount += item.taxAmount;
    
    if (item.isRecoverable) {
      summary.recoverableDepreciation += item.depreciationAmount;
    } else {
      summary.nonRecoverableDepreciation += item.depreciationAmount;
    }
    summary.totalDepreciation += item.depreciationAmount;
    summary.totalAcv += item.acv;
  }
  
  // Apply O&P to each coverage
  for (const [code, summary] of coverageMap) {
    const subtotalWithTax = summary.subtotalRcv + summary.taxAmount;
    
    if (qualifiesForOp && subtotalWithTax >= Number(carrier.opThreshold)) {
      summary.overheadAmount = subtotalWithTax * (Number(carrier.overheadPct) / 100);
      summary.profitAmount = subtotalWithTax * (Number(carrier.profitPct) / 100);
    }
    
    summary.totalRcv = subtotalWithTax + summary.overheadAmount + summary.profitAmount;
    
    // Apply deductible
    if (code === 'A') {
      summary.deductible = input.deductibleCovA || 0;
    } else if (code === 'B') {
      summary.deductible = input.deductibleCovB || 0;
    } else if (code === 'C') {
      summary.deductible = input.deductibleCovC || 0;
    }
    
    // Net claim = ACV - deductible (can't be negative)
    // Note: O&P should be recalculated on ACV basis for ACV claims
    const acvWithOp = summary.totalAcv + summary.overheadAmount + summary.profitAmount - summary.totalDepreciation;
    summary.netClaim = Math.max(0, summary.totalAcv - summary.deductible);
  }
  
  const coverageSummaries = Array.from(coverageMap.values());
  
  // 5. Calculate grand totals
  const totals = {
    subtotalMaterials: calculatedItems.reduce((sum, i) => sum + i.materialCost, 0),
    subtotalLabor: calculatedItems.reduce((sum, i) => sum + i.laborCost, 0),
    subtotalEquipment: calculatedItems.reduce((sum, i) => sum + i.equipmentCost, 0),
    subtotalBeforeOp: calculatedItems.reduce((sum, i) => sum + i.lineTotalWithTax, 0),
    overheadAmount: coverageSummaries.reduce((sum, s) => sum + s.overheadAmount, 0),
    profitAmount: coverageSummaries.reduce((sum, s) => sum + s.profitAmount, 0),
    taxAmount: calculatedItems.reduce((sum, i) => sum + i.taxAmount, 0),
    totalRcv: coverageSummaries.reduce((sum, s) => sum + s.totalRcv, 0),
    totalDepreciation: coverageSummaries.reduce((sum, s) => sum + s.totalDepreciation, 0),
    totalAcv: coverageSummaries.reduce((sum, s) => sum + s.totalAcv, 0),
    recoverableDepreciation: coverageSummaries.reduce((sum, s) => sum + s.recoverableDepreciation, 0),
    nonRecoverableDepreciation: coverageSummaries.reduce((sum, s) => sum + s.nonRecoverableDepreciation, 0),
    netClaimCovA: coverageSummaries.find(s => s.coverageCode === 'A')?.netClaim || 0,
    netClaimCovB: coverageSummaries.find(s => s.coverageCode === 'B')?.netClaim || 0,
    netClaimCovC: coverageSummaries.find(s => s.coverageCode === 'C')?.netClaim || 0,
    netClaimTotal: coverageSummaries.reduce((sum, s) => sum + s.netClaim, 0)
  };
  
  return {
    lineItems: calculatedItems,
    coverageSummaries,
    totals,
    meta: {
      priceListCode: input.priceListId || 'NATL_DEC25',
      regionCode: input.regionCode,
      carrierName: carrier.carrierName,
      calculatedAt: new Date(),
      tradesInvolved: Array.from(tradesInvolved),
      qualifiesForOp
    }
  };
}

// Save estimate to database
export async function saveEstimate(
  input: EstimateInput, 
  result: EstimateResult
): Promise<string> {
  
  // Start transaction
  return await db.transaction(async (tx) => {
    // 1. Create estimate record
    const [estimate] = await tx
      .insert(estimates)
      .values({
        claimId: input.claimId,
        regionCode: input.regionCode,
        carrierProfileId: input.carrierProfileId,
        priceListId: input.priceListId,
        propertyAddress: input.propertyAddress,
        propertyZip: input.propertyZip,
        dateOfLoss: input.dateOfLoss,
        yearBuilt: input.yearBuilt,
        roofAgeYears: input.roofAgeYears,
        overallCondition: input.overallCondition,
        deductibleCovA: input.deductibleCovA,
        deductibleCovB: input.deductibleCovB,
        deductibleCovC: input.deductibleCovC,
        subtotalMaterials: result.totals.subtotalMaterials,
        subtotalLabor: result.totals.subtotalLabor,
        subtotalEquipment: result.totals.subtotalEquipment,
        subtotalBeforeOp: result.totals.subtotalBeforeOp,
        overheadAmount: result.totals.overheadAmount,
        profitAmount: result.totals.profitAmount,
        taxAmount: result.totals.taxAmount,
        totalRcv: result.totals.totalRcv,
        totalDepreciation: result.totals.totalDepreciation,
        totalAcv: result.totals.totalAcv,
        recoverableDepreciation: result.totals.recoverableDepreciation,
        nonRecoverableDepreciation: result.totals.nonRecoverableDepreciation,
        netClaimCovA: result.totals.netClaimCovA,
        netClaimCovB: result.totals.netClaimCovB,
        netClaimCovC: result.totals.netClaimCovC,
        netClaimTotal: result.totals.netClaimTotal
      })
      .returning();
    
    // 2. Insert line items
    for (let i = 0; i < result.lineItems.length; i++) {
      const item = result.lineItems[i];
      await tx.insert(estimateLineItems).values({
        estimateId: estimate.id,
        lineNumber: i + 1,
        code: item.lineItemCode,
        description: item.description,
        categoryCode: item.categoryCode,
        quantity: item.quantity,
        unitOfMeasure: item.unitOfMeasure,
        unitPrice: item.unitPrice,
        materialCost: item.materialCost,
        laborCost: item.laborCost,
        equipmentCost: item.equipmentCost,
        wasteFactor: item.wasteFactor,
        wasteAmount: item.wasteAmount,
        lineRcv: item.lineRcv,
        taxAmount: item.taxAmount,
        lineTotalWithTax: item.lineTotalWithTax,
        ageYears: item.ageYears,
        usefulLifeYears: item.usefulLifeYears,
        condition: item.condition,
        depreciationPct: item.depreciationPct,
        depreciationAmount: item.depreciationAmount,
        isRecoverable: item.isRecoverable,
        acv: item.acv,
        coverageCode: item.coverageCode,
        damageAreaId: item.damageAreaId,
        notes: item.notes
      });
    }
    
    // 3. Insert coverage summaries
    for (const summary of result.coverageSummaries) {
      await tx.insert(estimateCoverageSummary).values({
        estimateId: estimate.id,
        coverageCode: summary.coverageCode,
        subtotalRcv: summary.subtotalRcv,
        taxAmount: summary.taxAmount,
        overheadAmount: summary.overheadAmount,
        profitAmount: summary.profitAmount,
        totalRcv: summary.totalRcv,
        recoverableDepreciation: summary.recoverableDepreciation,
        nonRecoverableDepreciation: summary.nonRecoverableDepreciation,
        totalDepreciation: summary.totalDepreciation,
        totalAcv: summary.totalAcv,
        deductible: summary.deductible,
        netClaim: summary.netClaim
      });
    }
    
    return estimate.id;
  });
}
```

---

## Part 9: API Routes

```typescript
// server/routes/estimates.ts

import { Hono } from 'hono';
import { z } from 'zod';
import { zValidator } from '@hono/zod-validator';
import { calculateEstimate, saveEstimate } from '../services/estimateCalculator';
import { db } from '../db';
import { 
  estimates, 
  estimateLineItems, 
  estimateCoverageSummary,
  lineItems,
  lineItemCategories,
  regionalMultipliers,
  carrierProfiles,
  laborRates,
  materials
} from '../db/schema';
import { eq, ilike, and, or } from 'drizzle-orm';

const app = new Hono();

// === LINE ITEMS ===

// Search line items
app.get('/api/line-items', async (c) => {
  const query = c.req.query('q') || '';
  const category = c.req.query('category');
  const limit = Math.min(parseInt(c.req.query('limit') || '50'), 200);
  
  let conditions = [eq(lineItems.isActive, true)];
  
  if (query) {
    conditions.push(
      or(
        ilike(lineItems.name, `%${query}%`),
        ilike(lineItems.code, `%${query}%`),
        ilike(lineItems.description, `%${query}%`)
      )
    );
  }
  
  if (category) {
    conditions.push(eq(lineItems.categoryCode, category));
  }
  
  const items = await db
    .select()
    .from(lineItems)
    .where(and(...conditions))
    .limit(limit);
  
  return c.json({ items, count: items.length });
});

// Get line item by code
app.get('/api/line-items/:code', async (c) => {
  const code = c.req.param('code');
  
  const [item] = await db
    .select()
    .from(lineItems)
    .where(eq(lineItems.code, code));
  
  if (!item) {
    return c.json({ error: 'Line item not found' }, 404);
  }
  
  return c.json(item);
});

// Get all categories
app.get('/api/line-item-categories', async (c) => {
  const categories = await db
    .select()
    .from(lineItemCategories)
    .where(eq(lineItemCategories.isActive, true))
    .orderBy(lineItemCategories.sortOrder);
  
  // Build tree structure
  const tree = categories
    .filter(c => !c.parentCode)
    .map(parent => ({
      ...parent,
      children: categories.filter(c => c.parentCode === parent.code)
    }));
  
  return c.json(tree);
});

// === MATERIALS ===

app.get('/api/materials', async (c) => {
  const query = c.req.query('q') || '';
  const category = c.req.query('category');
  const limit = Math.min(parseInt(c.req.query('limit') || '50'), 200);
  
  let conditions = [eq(materials.isActive, true)];
  
  if (query) {
    conditions.push(
      or(
        ilike(materials.name, `%${query}%`),
        ilike(materials.sku, `%${query}%`)
      )
    );
  }
  
  if (category) {
    conditions.push(eq(materials.categoryCode, category));
  }
  
  const items = await db
    .select()
    .from(materials)
    .where(and(...conditions))
    .limit(limit);
  
  return c.json({ items, count: items.length });
});

// === PRICING CONTEXT ===

app.get('/api/regions', async (c) => {
  const regions = await db
    .select()
    .from(regionalMultipliers)
    .where(eq(regionalMultipliers.isActive, true));
  
  return c.json(regions);
});

app.get('/api/carrier-profiles', async (c) => {
  const carriers = await db
    .select()
    .from(carrierProfiles)
    .where(eq(carrierProfiles.isActive, true));
  
  return c.json(carriers);
});

app.get('/api/labor-rates', async (c) => {
  const region = c.req.query('region') || 'NATIONAL';
  
  const rates = await db
    .select()
    .from(laborRates)
    .where(and(
      eq(laborRates.regionCode, region),
      eq(laborRates.isActive, true)
    ));
  
  return c.json(rates);
});

// === ESTIMATES ===

const estimateInputSchema = z.object({
  claimId: z.string().uuid(),
  regionCode: z.string(),
  carrierProfileId: z.string().optional(),
  priceListId: z.string().optional(),
  propertyAddress: z.string().optional(),
  propertyZip: z.string().optional(),
  dateOfLoss: z.string().optional().transform(v => v ? new Date(v) : undefined),
  yearBuilt: z.number().optional(),
  roofAgeYears: z.number().optional(),
  overallCondition: z.enum(['Good', 'Average', 'Poor']).optional(),
  deductibleCovA: z.number().optional(),
  deductibleCovB: z.number().optional(),
  deductibleCovC: z.number().optional(),
  lineItems: z.array(z.object({
    lineItemCode: z.string(),
    quantity: z.number().positive(),
    damageAreaId: z.string().uuid().optional(),
    coverageCode: z.string().optional(),
    ageYears: z.number().optional(),
    condition: z.enum(['Good', 'Average', 'Poor']).optional(),
    notes: z.string().optional()
  }))
});

// Calculate estimate (preview, don't save)
app.post('/api/estimates/calculate', zValidator('json', estimateInputSchema), async (c) => {
  const input = c.req.valid('json');
  
  try {
    const result = await calculateEstimate(input);
    return c.json(result);
  } catch (error) {
    return c.json({ error: error.message }, 400);
  }
});

// Create and save estimate
app.post('/api/estimates', zValidator('json', estimateInputSchema), async (c) => {
  const input = c.req.valid('json');
  
  try {
    const result = await calculateEstimate(input);
    const estimateId = await saveEstimate(input, result);
    
    return c.json({ 
      id: estimateId, 
      ...result 
    }, 201);
  } catch (error) {
    return c.json({ error: error.message }, 400);
  }
});

// Get estimate by ID
app.get('/api/estimates/:id', async (c) => {
  const id = c.req.param('id');
  
  const [estimate] = await db
    .select()
    .from(estimates)
    .where(eq(estimates.id, id));
  
  if (!estimate) {
    return c.json({ error: 'Estimate not found' }, 404);
  }
  
  const items = await db
    .select()
    .from(estimateLineItems)
    .where(eq(estimateLineItems.estimateId, id))
    .orderBy(estimateLineItems.lineNumber);
  
  const coverages = await db
    .select()
    .from(estimateCoverageSummary)
    .where(eq(estimateCoverageSummary.estimateId, id));
  
  return c.json({
    ...estimate,
    lineItems: items,
    coverageSummaries: coverages
  });
});

// Get estimates for a claim
app.get('/api/claims/:claimId/estimates', async (c) => {
  const claimId = c.req.param('claimId');
  
  const claimEstimates = await db
    .select()
    .from(estimates)
    .where(eq(estimates.claimId, claimId))
    .orderBy(estimates.createdAt);
  
  return c.json(claimEstimates);
});

export default app;
```

---

## Part 10: Migration & Seeding

After creating all the schema files, run:

```bash
# Generate migration (if using Drizzle)
npx drizzle-kit generate:pg

# Push to database
npx drizzle-kit push:pg

# Or run the SQL directly
psql $DATABASE_URL -f ./migrations/complete_estimate_schema.sql

# Seed the data
psql $DATABASE_URL -f ./seeds/price_lists.sql
psql $DATABASE_URL -f ./seeds/coverage_types.sql
psql $DATABASE_URL -f ./seeds/tax_rates.sql
psql $DATABASE_URL -f ./seeds/depreciation_schedules.sql
psql $DATABASE_URL -f ./seeds/regional_multipliers.sql
psql $DATABASE_URL -f ./seeds/labor_rates.sql
psql $DATABASE_URL -f ./seeds/carrier_profiles.sql
psql $DATABASE_URL -f ./seeds/line_item_categories.sql
psql $DATABASE_URL -f ./seeds/materials.sql
psql $DATABASE_URL -f ./seeds/line_items.sql
```

---

## Part 11: Verification

Run these queries to verify setup:

```sql
-- Check line item counts by category
SELECT 
  c.code,
  c.name,
  COUNT(l.id) as line_item_count
FROM line_item_categories c
LEFT JOIN line_items l ON l.category_code = c.code
WHERE c.parent_code IS NOT NULL
GROUP BY c.code, c.name
ORDER BY c.code;

-- Check material counts
SELECT COUNT(*) as material_count FROM materials WHERE is_active = true;

-- Check depreciation schedules
SELECT category_code, COUNT(*) as schedule_count 
FROM depreciation_schedules 
GROUP BY category_code 
ORDER BY category_code;

-- Test a simple estimate calculation
SELECT 
  li.code,
  li.name,
  li.unit_price,
  ds.useful_life_years,
  ds.max_depreciation_pct
FROM line_items li
LEFT JOIN depreciation_schedules ds 
  ON ds.category_code = li.category_code 
  AND ds.item_type = li.depreciation_type
WHERE li.code = 'RFG-SHNG-ARCH';
```

---

## Success Criteria

- [ ] 150+ line items across all categories
- [ ] Depreciation schedules for all depreciable items
- [ ] Coverage A/B/C assignment working
- [ ] Regional multipliers applying correctly
- [ ] Tax calculations accurate
- [ ] O&P calculating with trade minimum rules
- [ ] ACV = RCV - Depreciation
- [ ] Net Claim = ACV - Deductible
- [ ] All API endpoints returning data
- [ ] Estimate matches Xactimate format structure

---

## Next Steps After This Build

1. **PDF Report Generator** — Generate Xactimate-style PDF reports
2. **ESX Export** — Export to Xactimate XML format
3. **1build/itel Integration** — Live pricing API hooks
4. **Sketch Zone Integration** — Connect damage areas to Sketch canvas
5. **Photo Attachment** — Link photos to line items and areas
6. **Voice Agent Integration** — Create estimates from field adjuster voice input